<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Geffen Cockpit Dashboard</title>
  <style>
    :root{
      /* Futuristic blue + metallic */
      --bg0:#070B1A;
      --bg1:#0B1230;
      --panel:#0C1638;
      --panel2:#0A1230;

      --ink:#EAF0FF;
      --muted:#B7C2E6;

      --electric:#2D7DFF;
      --electric2:#1E5BFF;
      --cyan:#7BE7FF;

      --metal:#9AA7C1;
      --metal2:#6D7A96;

      --gold:#FFE066;
      --red:#FF5A5A;

      --line: rgba(255,255,255,.10);
      --line2: rgba(255,255,255,.18);

      --radius: 18px;
      --radius2: 26px;

      --shadow: 0 18px 60px rgba(0,0,0,.55);
      --shadow2: 0 10px 28px rgba(0,0,0,.35);

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --serif: ui-serif, Georgia, "Times New Roman", serif;

      --ringSize: 640px;         /* bigger ring (requested) */
      --ringRadius: 275px;       /* orbit radius */
      --nodeW: 180px;
      --nodeH: 64px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      color:var(--ink);
      font-family:var(--sans);
      background: radial-gradient(1200px 700px at 20% 0%, rgba(45,125,255,.18), transparent 55%),
                  radial-gradient(1100px 620px at 80% 18%, rgba(123,231,255,.12), transparent 60%),
                  radial-gradient(900px 520px at 60% 95%, rgba(255,224,102,.08), transparent 55%),
                  linear-gradient(180deg, var(--bg0), var(--bg1));
      overflow-x:hidden;
    }

    /* Subtle stars + scanlines */
    .stars, .scanlines, .fog{
      position:fixed;
      inset:0;
      pointer-events:none;
      z-index:0;
    }
    .stars{
      background-image:
        radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,.40) 30%, transparent 35%),
        radial-gradient(1.5px 1.5px at 120px 180px, rgba(255,255,255,.35) 30%, transparent 35%),
        radial-gradient(1.2px 1.2px at 260px 90px, rgba(255,255,255,.25) 30%, transparent 35%),
        radial-gradient(1.6px 1.6px at 420px 220px, rgba(255,255,255,.30) 30%, transparent 35%),
        radial-gradient(1.2px 1.2px at 640px 140px, rgba(255,255,255,.20) 30%, transparent 35%),
        radial-gradient(1px 1px at 780px 260px, rgba(255,255,255,.25) 30%, transparent 35%);
      background-size: 900px 520px;
      opacity:.35;
      filter: blur(.15px);
      animation: drift 22s linear infinite;
    }
    @keyframes drift{
      from{ transform: translate3d(0,0,0); }
      to{ transform: translate3d(-120px, 40px, 0); }
    }

    .scanlines{
      background: repeating-linear-gradient(
        to bottom,
        rgba(255,255,255,.03),
        rgba(255,255,255,.03) 1px,
        transparent 1px,
        transparent 3px
      );
      opacity:.16;
      mix-blend-mode: overlay;
    }

    .fog{
      background:
        radial-gradient(1000px 600px at 25% 60%, rgba(123,231,255,.10), transparent 60%),
        radial-gradient(900px 520px at 70% 45%, rgba(45,125,255,.09), transparent 60%),
        radial-gradient(700px 420px at 50% 85%, rgba(255,224,102,.06), transparent 65%);
      filter: blur(12px);
      opacity:.6;
      animation: fogMove 14s ease-in-out infinite alternate;
    }
    @keyframes fogMove{
      from{ transform: translate3d(-10px, 0, 0) scale(1.02); }
      to{ transform: translate3d(12px, -8px, 0) scale(1.03); }
    }

    /* Top bar (search + time) */
    .topbar{
      position:sticky;
      top:0;
      z-index:5;
      padding: 14px 16px;
      backdrop-filter: blur(10px);
      background: linear-gradient(to bottom, rgba(7,11,26,.78), rgba(7,11,26,.42));
      border-bottom: 1px solid rgba(255,255,255,.10);
    }
    .topbarInner{
      max-width: 1300px;
      margin:0 auto;
      display:flex;
      gap: 14px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
    }

    .brand{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 240px;
    }
    .brand .title{
      font-family: var(--serif);
      letter-spacing:.6px;
      font-weight: 800;
      font-size: 18px;
      line-height:1.1;
      color: var(--ink);
      text-shadow: 0 0 18px rgba(45,125,255,.25);
    }
    .brand .subtitle{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,240,255,.72);
    }

    .clockBox{
      display:flex;
      gap:10px;
      align-items:baseline;
      font-family: var(--mono);
      padding: 10px 12px;
      border-radius: 14px;
      background: linear-gradient(180deg, rgba(12,22,56,.85), rgba(10,18,48,.75));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow2);
      min-width: 260px;
      justify-content:center;
    }
    .clockBox .date{ color: rgba(234,240,255,.75); font-size: 12px; }
    .clockBox .time{ color: var(--ink); font-size: 15px; font-weight: 900; }
    .clockBox .ticks{ color: rgba(123,231,255,.85); font-size: 12px; }

    .searchWrap{
      flex: 1;
      min-width: 280px;
      max-width: 560px;
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(12,22,56,.85), rgba(10,18,48,.70));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow2);
    }
    .searchWrap .lens{
      width: 18px; height: 18px;
      border-radius: 50%;
      border: 2px solid rgba(123,231,255,.75);
      position:relative;
      opacity:.95;
    }
    .searchWrap .lens:after{
      content:"";
      position:absolute;
      width: 10px; height: 2px;
      background: rgba(123,231,255,.75);
      right:-8px; bottom:-3px;
      transform: rotate(45deg);
      border-radius: 3px;
    }
    .searchWrap input{
      flex:1;
      background: transparent;
      border: none;
      outline:none;
      color: var(--ink);
      font-family: var(--mono);
      font-size: 13px;
    }
    .searchWrap button{
      border:none;
      cursor:pointer;
      color: #07101f;
      font-weight: 900;
      font-family: var(--mono);
      font-size: 12px;
      padding: 8px 12px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(123,231,255,.95), rgba(45,125,255,.92));
      box-shadow: 0 0 0 1px rgba(255,255,255,.12) inset, 0 10px 22px rgba(0,0,0,.35);
      transition: transform .08s ease, filter .18s ease;
    }
    .searchWrap button:hover{ filter: brightness(1.05); }
    .searchWrap button:active{ transform: translateY(1px); }

    /* Main layout */
    .shell{
      position:relative;
      z-index:1;
      max-width: 1300px;
      margin: 18px auto 40px auto;
      padding: 0 16px;
      display:grid;
      grid-template-columns: 1.1fr .9fr; /* left ring + right cockpit */
      gap: 16px;
      align-items:start;
    }
    @media (max-width: 1040px){
      .shell{ grid-template-columns: 1fr; }
      :root{ --ringSize: 560px; --ringRadius: 240px; }
    }
    @media (max-width: 680px){
      :root{ --ringSize: 500px; --ringRadius: 210px; --nodeW: 168px; }
    }

    /* Left: ring bay */
    .bay{
      position:relative;
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(12,22,56,.76), rgba(10,18,48,.62));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      overflow:hidden;
      min-height: calc(var(--ringSize) + 64px);
    }
    .bay::before{
      content:"";
      position:absolute;
      inset:-2px;
      background:
        radial-gradient(900px 420px at 25% 30%, rgba(45,125,255,.22), transparent 60%),
        radial-gradient(700px 360px at 70% 60%, rgba(123,231,255,.14), transparent 55%),
        radial-gradient(520px 320px at 50% 90%, rgba(255,224,102,.08), transparent 60%);
      filter: blur(10px);
      opacity:.9;
      pointer-events:none;
    }

    .bayHeader{
      position:relative;
      z-index:2;
      padding: 14px 14px 10px 14px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(to bottom, rgba(255,255,255,.06), transparent);
    }
    .bayHeader .h1{
      display:flex;
      flex-direction:column;
      gap:3px;
    }
    .bayHeader .h1 b{
      font-family: var(--mono);
      letter-spacing:.14em;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(234,240,255,.85);
    }
    .bayHeader .h1 span{
      font-size: 12px;
      color: rgba(234,240,255,.70);
    }
    .bayHeader .hint{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(183,194,230,.80);
      text-align:right;
      line-height:1.2;
    }

    .ringStage{
      position:relative;
      z-index:2;
      height: var(--ringSize);
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 22px 14px 18px 14px;
      user-select:none;
    }

    .ring{
      width: var(--ringSize);
      height: var(--ringSize);
      border-radius: 50%;
      position:relative;
      transform: translateZ(0);
      /* ensure wheel events are captured */
    }

    /* Outer ring */
    .ring:before{
      content:"";
      position:absolute;
      inset: 22px;
      border-radius:50%;
      border: 1px solid rgba(123,231,255,.22);
      box-shadow:
        0 0 0 1px rgba(45,125,255,.16) inset,
        0 0 26px rgba(45,125,255,.14),
        0 0 80px rgba(45,125,255,.08);
      background:
        radial-gradient(circle at 50% 50%, rgba(12,22,56,.40), rgba(7,11,26,.55));
    }
    /* Inner technical etching */
    .ring:after{
      content:"";
      position:absolute;
      inset: 64px;
      border-radius:50%;
      border: 1px dashed rgba(255,255,255,.12);
      box-shadow: 0 0 0 1px rgba(255,255,255,.06) inset;
      opacity:.9;
      pointer-events:none;
    }

    /* center holo readout that DOESN'T block links */
    .holo{
      position:absolute;
      inset: 140px;
      border-radius: 24px;
      background: linear-gradient(180deg, rgba(12,22,56,.40), rgba(10,18,48,.18));
      border: 1px solid rgba(255,255,255,.10);
      box-shadow: 0 0 0 1px rgba(45,125,255,.10) inset;
      backdrop-filter: blur(8px);
      display:flex;
      flex-direction:column;
      gap:10px;
      padding: 14px 14px 12px 14px;
      pointer-events:none; /* KEY: doesn't break link clicking */
    }
    .holo .holoTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .holo .tag{
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(123,231,255,.85);
    }
    .holo .sub{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,240,255,.65);
    }
    .holo .list{
      display:grid;
      gap: 6px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(234,240,255,.82);
    }
    .holo .line{
      display:flex;
      gap:8px;
      align-items:center;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .holo .dot{
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: rgba(123,231,255,.85);
      box-shadow: 0 0 10px rgba(123,231,255,.35);
      flex: 0 0 auto;
    }
    .holo .line.done{ opacity:.50; }
    .holo .line.done .dot{ background: rgba(255,255,255,.40); box-shadow:none; }

    /* orbit nodes */
    .node{
      position:absolute;
      width: var(--nodeW);
      height: var(--nodeH);
      left: 50%;
      top: 50%;
      transform: translate(-50%,-50%);
      will-change: transform;
      cursor:pointer;
    }

    .cardLink{
      width: 100%;
      height: 100%;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding: 10px 12px;
      border-radius: 16px;
      text-decoration:none;
      color: var(--ink);
      background:
        linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04)),
        linear-gradient(180deg, rgba(12,22,56,.78), rgba(10,18,48,.70));
      border: 1px solid rgba(255,255,255,.14);
      box-shadow:
        0 0 0 1px rgba(45,125,255,.10) inset,
        0 14px 26px rgba(0,0,0,.38);
      position:relative;
      overflow:hidden;
      transition: transform .12s ease, border-color .18s ease, filter .18s ease;
      pointer-events:auto;
    }
    .cardLink:before{
      content:"";
      position:absolute;
      inset:-1px;
      background: radial-gradient(240px 90px at 30% 30%, rgba(123,231,255,.18), transparent 60%);
      opacity:.9;
      pointer-events:none;
    }
    .cardLink:hover{
      transform: translateY(-2px);
      border-color: rgba(123,231,255,.28);
      filter: brightness(1.05);
    }
    .cardLink:active{
      transform: translateY(-1px);
    }

    .cardLeft{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 0;
    }
    .cardLeft b{
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing:.08em;
      text-transform: uppercase;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .cardLeft span{
      font-family: var(--mono);
      font-size: 10px;
      color: rgba(234,240,255,.70);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .glyph{
      width: 34px;
      height: 34px;
      border-radius: 12px;
      background: linear-gradient(180deg, rgba(123,231,255,.85), rgba(45,125,255,.88));
      box-shadow: 0 0 0 1px rgba(255,255,255,.16) inset, 0 10px 18px rgba(0,0,0,.35);
      display:flex;
      align-items:center;
      justify-content:center;
      color:#07101f;
      font-weight: 900;
      font-family: var(--mono);
      flex: 0 0 auto;
    }

    /* energy bar */
    .energyWrap{
      position:relative;
      z-index:2;
      padding: 0 14px 14px 14px;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .energyBar{
      width: min(640px, 92%);
      height: 14px;
      border-radius: 999px;
      background: rgba(255,255,255,.07);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 0 0 1px rgba(0,0,0,.18) inset;
      position:relative;
      overflow:hidden;
    }
    .energyFill{
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, rgba(123,231,255,.95), rgba(45,125,255,.92), rgba(255,224,102,.86));
      box-shadow: 0 0 22px rgba(45,125,255,.24);
      transition: width 1.2s ease;
      position:relative;
    }
    /* occasional electricity crackles around the bar */
    .energyBar .crackle{
      position:absolute;
      inset:-10px -8px;
      background:
        radial-gradient(16px 10px at 20% 40%, rgba(123,231,255,.0), rgba(123,231,255,.0) 55%, rgba(123,231,255,.35) 60%, rgba(123,231,255,0) 70%),
        radial-gradient(18px 12px at 60% 70%, rgba(45,125,255,.0), rgba(45,125,255,.0) 58%, rgba(45,125,255,.30) 63%, rgba(45,125,255,0) 74%),
        radial-gradient(14px 10px at 80% 25%, rgba(255,224,102,.0), rgba(255,224,102,.0) 60%, rgba(255,224,102,.22) 66%, rgba(255,224,102,0) 78%);
      opacity: 0;
      pointer-events:none;
      filter: blur(.2px);
      animation: crackle 5.6s infinite;
    }
    @keyframes crackle{
      0%, 84%, 100% { opacity:0; transform: translate3d(0,0,0); }
      86% { opacity:.65; transform: translate3d(0,-1px,0) scale(1.01); }
      88% { opacity:.25; transform: translate3d(2px,0,0) scale(1.00); }
      90% { opacity:.55; transform: translate3d(-1px,1px,0) scale(1.01); }
      92% { opacity:.0; transform: translate3d(0,0,0); }
    }
    .energyMeta{
      margin-top: 8px;
      width: min(640px, 92%);
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,240,255,.70);
    }
    .energyMeta b{ color: rgba(234,240,255,.88); }

    /* Right cockpit panel */
    .cockpit{
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(12,22,56,.82), rgba(10,18,48,.70));
      border: 1px solid rgba(255,255,255,.12);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .cockpit::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(620px 360px at 30% 10%, rgba(123,231,255,.14), transparent 60%);
      filter: blur(10px);
      opacity:.9;
      pointer-events:none;
    }

    .cockHeader{
      position:relative;
      z-index:2;
      padding: 14px 14px 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
      background: linear-gradient(to bottom, rgba(255,255,255,.06), transparent);
    }
    .cockHeader .left{
      display:flex;
      flex-direction:column;
      gap: 4px;
    }
    .cockHeader .left b{
      font-family: var(--mono);
      letter-spacing:.14em;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(234,240,255,.85);
    }
    .cockHeader .left span{
      font-size: 12px;
      color: rgba(234,240,255,.70);
    }

    .pill{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,240,255,.72);
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      border-radius: 999px;
      padding: 8px 10px;
      display:inline-flex;
      align-items:center;
      gap: 8px;
      box-shadow: 0 0 0 1px rgba(0,0,0,.14) inset;
      white-space:nowrap;
    }
    .pill .spark{
      width: 8px; height: 8px; border-radius:50%;
      background: rgba(123,231,255,.95);
      box-shadow: 0 0 12px rgba(123,231,255,.35);
    }

    .cockBody{
      position:relative;
      z-index:2;
      padding: 14px;
      display:grid;
      gap: 12px;
    }

    .module{
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,.12);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      box-shadow: 0 0 0 1px rgba(45,125,255,.08) inset, 0 12px 26px rgba(0,0,0,.28);
      overflow:hidden;
    }
    .moduleHd{
      padding: 12px 12px 10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap: 10px;
      border-bottom: 1px solid rgba(255,255,255,.10);
      background: linear-gradient(to bottom, rgba(255,255,255,.06), transparent);
    }
    .moduleHd b{
      font-family: var(--mono);
      font-size: 12px;
      letter-spacing:.14em;
      text-transform: uppercase;
      color: rgba(123,231,255,.88);
    }
    .moduleHd .mini{
      display:flex;
      gap: 8px;
      align-items:center;
    }

    .btn{
      border:none;
      cursor:pointer;
      font-family: var(--mono);
      font-size: 12px;
      font-weight: 900;
      padding: 9px 10px;
      border-radius: 14px;
      transition: transform .08s ease, filter .18s ease, background .18s ease;
      user-select:none;
      white-space:nowrap;
    }
    .btn:active{ transform: translateY(1px); }

    .btnPrimary{
      color:#07101f;
      background: linear-gradient(180deg, rgba(123,231,255,.95), rgba(45,125,255,.92));
      box-shadow: 0 0 0 1px rgba(255,255,255,.14) inset, 0 12px 22px rgba(0,0,0,.34);
    }
    .btnGhost{
      color: rgba(234,240,255,.88);
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 0 0 1px rgba(0,0,0,.16) inset;
    }
    .btnDanger{
      color: rgba(255,90,90,.95);
      background: rgba(255,90,90,.08);
      border: 1px solid rgba(255,90,90,.22);
      box-shadow: 0 0 0 1px rgba(0,0,0,.14) inset;
    }
    .btnGhost:hover,.btnPrimary:hover{ filter: brightness(1.05); }

    .moduleBd{
      padding: 12px;
      display:grid;
      gap: 10px;
    }

    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 1040px){
      .row2{ grid-template-columns: 1fr; }
    }

    label{
      display:block;
      font-family: var(--mono);
      font-size: 11px;
      letter-spacing:.06em;
      text-transform: uppercase;
      color: rgba(234,240,255,.70);
      margin: 0 0 6px 0;
    }
    input[type="text"], select, textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(7,11,26,.35);
      color: var(--ink);
      padding: 10px 10px;
      outline:none;
      font-family: var(--mono);
      font-size: 13px;
      transition: box-shadow .15s ease, border-color .15s ease;
    }
    input[type="text"]:focus, select:focus, textarea:focus{
      border-color: rgba(123,231,255,.30);
      box-shadow: 0 0 0 4px rgba(45,125,255,.18);
    }
    textarea{
      min-height: 120px;
      resize: vertical;
    }

    .checkGrid{
      display:grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    @media (max-width: 520px){
      .checkGrid{ grid-template-columns: 1fr; }
    }
    .checkItem{
      display:flex;
      align-items:center;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
    }
    .checkItem input{
      width: 18px; height: 18px;
      accent-color: var(--electric);
    }
    .checkItem span{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(234,240,255,.85);
      letter-spacing:.02em;
    }

    .todaySchedule{
      display:grid;
      gap: 8px;
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(234,240,255,.82);
    }
    .period{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap: 10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.04);
    }
    .period .l{
      min-width: 0;
      display:flex;
      flex-direction:column;
      gap: 2px;
    }
    .period .l b{
      font-size: 12px;
      color: rgba(234,240,255,.92);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .period .l span{
      font-size: 11px;
      color: rgba(234,240,255,.62);
    }
    .period .r{
      flex: 0 0 auto;
      color: rgba(123,231,255,.85);
      font-size: 11px;
      white-space:nowrap;
    }
    .period.now{
      border-color: rgba(123,231,255,.28);
      box-shadow: 0 0 0 1px rgba(45,125,255,.10) inset, 0 0 26px rgba(45,125,255,.12);
      background: rgba(45,125,255,.10);
    }

    /* Checklist controls row (aligned + cockpit-y) */
    .addRow{
      display:grid;
      grid-template-columns: 1fr auto auto;
      gap: 10px;
      align-items:center;
    }
    @media (max-width: 520px){
      .addRow{ grid-template-columns: 1fr; }
    }

    .tinyHint{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(234,240,255,.62);
      line-height:1.25;
    }

    /* Export / import drawer */
    .overlay{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 50;
      padding: 18px;
    }
    .modal{
      width: min(860px, 96vw);
      border-radius: 22px;
      background: linear-gradient(180deg, rgba(12,22,56,.92), rgba(10,18,48,.88));
      border: 1px solid rgba(255,255,255,.16);
      box-shadow: 0 24px 80px rgba(0,0,0,.60);
      overflow:hidden;
    }
    .modalHd{
      padding: 14px 14px 12px 14px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modalHd b{
      font-family: var(--mono);
      letter-spacing:.14em;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(123,231,255,.90);
    }
    .modalBd{
      padding: 14px;
      display:grid;
      gap: 10px;
    }

    /* Small footer */
    .footer{
      max-width: 1300px;
      margin: 0 auto;
      padding: 0 16px 26px 16px;
      color: rgba(183,194,230,.72);
      font-family: var(--mono);
      font-size: 11px;
      text-align:center;
      z-index:1;
      position:relative;
    }
  </style>
</head>

<body>
  <div class="stars"></div>
  <div class="fog"></div>
  <div class="scanlines"></div>

  <div class="topbar">
    <div class="topbarInner">
      <div class="brand">
        <div class="title">GEFFEN COCKPIT</div>
        <div class="subtitle">Retro-future dashboard • wheel to rotate the ring</div>
      </div>

      <form class="searchWrap" action="https://www.google.com/search" method="GET" target="_blank" rel="noopener">
        <div class="lens" aria-hidden="true"></div>
        <input id="googleQ" name="q" type="text" placeholder="Search Google…" autocomplete="off" />
        <button type="submit">SEARCH</button>
      </form>

      <div class="clockBox" aria-label="Clock">
        <div class="date" id="dateStr">—</div>
        <div class="time" id="timeStr">—</div>
        <div class="ticks" id="ticksStr">.00</div>
      </div>
    </div>
  </div>

  <main class="shell">
    <!-- LEFT: Ring bay -->
    <section class="bay">
      <div class="bayHeader">
        <div class="h1">
          <b>Navigation Ring</b>
          <span>Scroll your wheel over the ring to rotate. Click a node to launch.</span>
        </div>
        <div class="hint">
          Tip: The center holo is read-only<br/>
          (so it won’t steal your clicks).
        </div>
      </div>

      <div class="ringStage">
        <div class="ring" id="ring" aria-label="Link ring">
          <!-- center holo (read-only) -->
          <div class="holo" aria-hidden="true">
            <div class="holoTop">
              <div class="tag">Today: checklist feed</div>
              <div class="sub" id="holoStatus">—</div>
            </div>
            <div class="list" id="holoList">
              <div class="line"><div class="dot"></div><div>Nothing yet. Add items on the right.</div></div>
            </div>
          </div>
          <!-- nodes inserted by JS -->
        </div>
      </div>

      <div class="energyWrap">
        <div style="width:100%;display:flex;flex-direction:column;align-items:center;">
          <div class="energyBar" aria-label="Energy bar">
            <div class="energyFill" id="energyFill"></div>
            <div class="crackle"></div>
          </div>
          <div class="energyMeta">
            <div><b>ENERGY GRID</b> <span id="energyPct">0%</span></div>
            <div id="energyNote">Awaiting schedule…</div>
          </div>
        </div>
      </div>
    </section>

    <!-- RIGHT: Cockpit -->
    <aside class="cockpit">
      <div class="cockHeader">
        <div class="left">
          <b>Control Console</b>
          <span>Schedule + agenda + export. Everything saves locally.</span>
        </div>
        <div class="pill"><span class="spark"></span><span id="dayModePill">—</span></div>
      </div>

      <div class="cockBody">
        <!-- TODAY schedule -->
        <div class="module">
          <div class="moduleHd">
            <b>Today’s Schedule</b>
            <div class="mini">
              <select id="weekMode" title="Week mode (Blue/Gold)">
                <option value="auto">Auto</option>
                <option value="blue">Blue</option>
                <option value="gold">Gold</option>
              </select>
            </div>
          </div>
          <div class="moduleBd">
            <div class="tinyHint" id="todayHint">
              Auto mode uses a locally saved “Blue anchor date” to determine Blue/Gold. If you haven’t set it yet, you can set it below.
            </div>
            <div class="todaySchedule" id="todaySchedule">
              <div class="period">
                <div class="l">
                  <b>Not configured yet</b>
                  <span>Open Schedule Setup and save your blocks.</span>
                </div>
                <div class="r">—</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Checklist -->
        <div class="module">
          <div class="moduleHd">
            <b>Agenda Checklist</b>
            <div class="mini">
              <button class="btn btnGhost" id="exportBtn" type="button">Export</button>
              <button class="btn btnGhost" id="importBtn" type="button">Import</button>
            </div>
          </div>
          <div class="moduleBd">
            <div class="addRow">
              <input id="newItem" type="text" placeholder="Add checklist item…" />
              <button class="btn btnPrimary" id="addItemBtn" type="button">Add</button>
              <button class="btn btnDanger" id="clearCheckedBtn" type="button">Clear</button>
            </div>
            <div class="tinyHint">Enter to add. Click items to toggle done. “Clear” removes only checked items.</div>
            <div id="checklist"></div>
          </div>
        </div>

        <!-- Schedule setup (collapsible) -->
        <div class="module" id="setupModule">
          <div class="moduleHd">
            <b>Schedule Setup</b>
            <div class="mini">
              <button class="btn btnGhost" id="toggleSetup" type="button">Collapse</button>
              <button class="btn btnPrimary" id="saveScheduleBtn" type="button">Save</button>
            </div>
          </div>
          <div class="moduleBd" id="setupBody">
            <div class="row2">
              <div>
                <label>Blue anchor date</label>
                <input id="blueAnchor" type="text" placeholder="YYYY-MM-DD (a Monday you know is Blue)" />
                <div class="tinyHint">Used for Auto week mode. If blank, Auto can’t determine Blue/Gold reliably.</div>
              </div>
              <div>
                <label>Office hours on H block</label>
                <select id="officeHoursMode">
                  <option value="none">None</option>
                  <option value="blue">Blue week only</option>
                  <option value="gold">Gold week only</option>
                  <option value="both">Both weeks</option>
                </select>
                <div class="tinyHint">If set, any H period will display “Office Hours” instead of H class name.</div>
              </div>
            </div>

            <div class="row2">
              <div>
                <label>A block name</label>
                <input id="A" type="text" placeholder="e.g., 10th Global" />
              </div>
              <div>
                <label>B block name</label>
                <input id="B" type="text" placeholder="e.g., Adv Civ" />
              </div>
            </div>
            <div class="row2">
              <div><label>C block name</label><input id="C" type="text" /></div>
              <div><label>D block name</label><input id="D" type="text" /></div>
            </div>
            <div class="row2">
              <div><label>E block name</label><input id="E" type="text" /></div>
              <div><label>F block name</label><input id="F" type="text" /></div>
            </div>
            <div class="row2">
              <div><label>G block name</label><input id="G" type="text" /></div>
              <div><label>H block name</label><input id="H" type="text" /></div>
            </div>

            <div class="tinyHint">
              This uses the same Blue/Gold day structure you provided, but focused on what you need daily: today’s periods and an energy bar that fills toward the last class.
            </div>
          </div>
        </div>
      </div>
    </aside>
  </main>

  <!-- Export/Import Modal -->
  <div class="overlay" id="overlay">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Export/Import">
      <div class="modalHd">
        <b id="modalTitle">Export</b>
        <button class="btn btnGhost" id="closeModal" type="button">Close</button>
      </div>
      <div class="modalBd">
        <div class="tinyHint" id="modalHint">Copy this JSON to move your setup to another computer.</div>
        <textarea id="jsonBox" spellcheck="false"></textarea>
        <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:flex-end;">
          <button class="btn btnGhost" id="copyJsonBtn" type="button">Copy</button>
          <button class="btn btnPrimary" id="applyJsonBtn" type="button" style="display:none;">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer">
    Wheel rotates the ring • Everything saved in your browser (localStorage) • Export JSON for portability
  </div>

  <script>
    /************************************************************
     * LINKS (ring nodes)
     ************************************************************/
    const links = [
      { label:"Discussion Tracker", sub:"class-discussion", href:"https://amhagler.github.io/class-discussion/", glyph:"DT" },
      { label:"Seating Chart", sub:"SC", href:"https://amhagler.github.io/SC/", glyph:"SC" },
      { label:"Rubric", sub:"rubric", href:"https://amhagler.github.io/rubric/", glyph:"RB" },
      { label:"Unit Calendar", sub:"uc", href:"https://amhagler.github.io/uc/", glyph:"UC" },
      { label:"Mafia", sub:"mafia", href:"https://amhagler.github.io/mafia/", glyph:"MF" },
      { label:"Trivia", sub:"tr", href:"https://amhagler.github.io/tr/", glyph:"TR" },
      { label:"Portal", sub:"myschoolapp login", href:"https://geffenacademy.myschoolapp.com/app#login", glyph:"PT" },
      { label:"Gradebook", sub:"SIS gradebook", href:"https://geffenacademy.myschoolapp.com/sis-gradebook/gradebook/27966135?svcid=edu&addin=1", glyph:"GB" },
    ];

    const ring = document.getElementById("ring");
    const ringRect = () => ring.getBoundingClientRect();

    let rotation = 0; // radians
    let targetRotation = 0;

    // Create nodes
    function buildNodes(){
      // remove existing nodes
      ring.querySelectorAll(".node").forEach(n => n.remove());

      links.forEach((l, idx) => {
        const node = document.createElement("div");
        node.className = "node";
        node.dataset.idx = String(idx);

        node.innerHTML = `
          <a class="cardLink" href="${l.href}" target="_blank" rel="noopener">
            <div class="cardLeft">
              <b>${l.label}</b>
              <span>${l.sub}</span>
            </div>
            <div class="glyph">${l.glyph}</div>
          </a>
        `;

        ring.appendChild(node);
      });
    }
    buildNodes();

    // Positioning logic (the bug you saw before usually comes from compounding transforms or mixing %
    // translate offsets with a rotating parent; here we compute each node position fresh every frame.)
    function layoutNodes(){
      const nodes = Array.from(ring.querySelectorAll(".node"));
      const r = parseFloat(getComputedStyle(document.documentElement).getPropertyValue("--ringRadius")) || 275;

      const n = nodes.length;
      for (let i = 0; i < n; i++){
        const theta = (Math.PI * 2) * (i / n) + rotation;

        const x = Math.cos(theta) * r;
        const y = Math.sin(theta) * r;

        // translate(-50%,-50%) anchors each node at ring center, then move by x,y
        // Keep nodes upright (no rotation) for readability.
        nodes[i].style.transform = `translate(calc(-50% + ${x}px), calc(-50% + ${y}px))`;
      }
    }

    // Wheel control (no crank)
    ring.addEventListener("wheel", (e) => {
      e.preventDefault();
      // Natural feel: scroll down rotates clockwise (tweak factor)
      const delta = (e.deltaY || 0);
      targetRotation += delta * 0.0022;
    }, { passive:false });

    // smooth rotation
    function animate(){
      // simple easing toward targetRotation
      rotation += (targetRotation - rotation) * 0.10;
      layoutNodes();
      requestAnimationFrame(animate);
    }
    animate();

    /************************************************************
     * CLOCK (hundredths)
     ************************************************************/
    const dateStr = document.getElementById("dateStr");
    const timeStr = document.getElementById("timeStr");
    const ticksStr = document.getElementById("ticksStr");

    function pad2(n){ return String(n).padStart(2,"0"); }

    function tickClock(){
      const now = new Date();
      const yyyy = now.getFullYear();
      const mm = pad2(now.getMonth()+1);
      const dd = pad2(now.getDate());
      dateStr.textContent = `${yyyy}-${mm}-${dd}`;

      const h = pad2(now.getHours());
      const m = pad2(now.getMinutes());
      const s = pad2(now.getSeconds());
      timeStr.textContent = `${h}:${m}:${s}`;

      const hundredths = Math.floor(now.getMilliseconds() / 10);
      ticksStr.textContent = `.${pad2(hundredths)}`;
      requestAnimationFrame(tickClock);
    }
    tickClock();

    /************************************************************
     * SCHEDULE DATA (your Blue/Gold structure, streamlined for today)
     ************************************************************/
    const blueWeek = {
      monday: [
        { time:"9:00-9:15", block:"Reading Period" },
        { time:"9:15-10:10", block:"A" },
        { time:"10:15-11:10", block:"B" },
        { time:"11:20-12:15", block:"C" },
        { time:"12:15-1:05", block:"MS/US Lunch +MS/US Clubs" },
        { time:"1:10-2:05", block:"D" },
        { time:"2:10-3:05", block:"E" },
        { time:"3:10-3:50", block:"H" }
      ],
      tuesday: [
        { time:"9:00-9:20", block:"Bulletin" },
        { time:"9:20-10:15", block:"F" },
        { time:"10:20-11:15", block:"G" },
        { time:"11:20-12:15", block:"A" },
        { time:"12:15-1:05", block:"MS/US Lunch +MS/US Clubs" },
        { time:"1:10-2:05", block:"B" },
        { time:"2:10-3:05", block:"C" },
        { time:"3:10-3:50", block:"H" }
      ],
      wednesday: [
        { time:"9:00-9:15", block:"Reading Period" },
        { time:"9:15-10:10", block:"D" },
        { time:"10:15-11:10", block:"E" },
        { time:"11:20-12:15", block:"F" },
        { time:"12:15-1:05", block:"MS/US Lunch +MS/US Clubs" },
        { time:"1:10-2:05", block:"G" },
        { time:"2:10-3:05", block:"A" },
        { time:"3:10-3:50", block:"H" }
      ],
      thursday: [
        { time:"9:00-9:15", block:"Reading Period" },
        { time:"9:15-10:10", block:"B" },
        { time:"10:15-11:10", block:"C" },
        { time:"11:20-12:15", block:"D" },
        { time:"12:15-1:05", block:"MS/US Lunch +MS/US Clubs" },
        { time:"1:10-2:05", block:"E" },
        { time:"2:10-3:05", block:"F" },
        { time:"3:10-3:50", block:"H" }
      ],
      friday: [
        { time:"8:00-8:50", block:"Educators’ Mtg." },
        { time:"9:00-9:55", block:"G" },
        { time:"10:00-10:55", block:"A" },
        { time:"11:05-12:00", block:"B" },
        { time:"12:00-1:05", block:"MS/US SuperLunch +Affinity Groups" },
        { time:"1:10-2:05", block:"C" },
        { time:"2:10-3:05", block:"D" },
        { time:"3:10-3:50", block:"H/X1" }
      ]
    };

    const goldWeek = {
      monday: [
        { time:"9:00-9:15", block:"Reading Period" },
        { time:"9:15-10:10", block:"E" },
        { time:"10:15-11:10", block:"F" },
        { time:"11:20-12:15", block:"G" },
        { time:"12:15-1:05", block:"MS/US Lunch +MS/US Clubs" },
        { time:"1:10-2:05", block:"A" },
        { time:"2:10-3:05", block:"B" },
        { time:"3:10-3:50", block:"H" }
      ],
      tuesday: [
        { time:"9:00-9:20", block:"Bulletin" },
        { time:"9:20-10:15", block:"C" },
        { time:"10:20-11:15", block:"D" },
        { time:"11:20-12:15", block:"E" },
        { time:"12:15-1:05", block:"MS/US Lunch +MS/US Clubs" },
        { time:"1:10-2:05", block:"F" },
        { time:"2:10-3:05", block:"G" },
        { time:"3:10-3:50", block:"H" }
      ],
      wednesday: [
        { time:"9:00-9:15", block:"Reading Period" },
        { time:"9:15-10:10", block:"A" },
        { time:"10:15-11:10", block:"B" },
        { time:"11:20-12:15", block:"C" },
        { time:"12:15-1:05", block:"MS/US Lunch +MS/US Clubs" },
        { time:"1:10-2:05", block:"D" },
        { time:"2:10-3:05", block:"E" },
        { time:"3:10-3:50", block:"H" }
      ],
      thursday: [
        { time:"9:00-9:15", block:"Reading Period" },
        { time:"9:15-10:10", block:"F" },
        { time:"10:15-11:10", block:"G" },
        { time:"11:20-12:15", block:"A" },
        { time:"12:15-1:05", block:"MS/US Lunch +MS/US Clubs" },
        { time:"1:10-2:05", block:"B" },
        { time:"2:10-3:05", block:"C" },
        { time:"3:10-3:50", block:"H" }
      ],
      friday: [
        { time:"8:00-8:50", block:"Educators’ Mtg." },
        { time:"9:00-9:55", block:"D" },
        { time:"10:00-10:55", block:"E" },
        { time:"11:00-11:45", block:"H" },
        { time:"11:45-12:35", block:"MS/US Lunch +MS/US Clubs" },
        { time:"12:40-1:35", block:"F" },
        { time:"1:40-2:35", block:"G" },
        { time:"2:40-3:20", block:"X3" }
      ]
    };

    const scheduleByWeek = { blue: blueWeek, gold: goldWeek };
    const dayKeys = ["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];

    function parseTimeToMinutes(t){
      // "9:15" or "1:05" -> minutes since midnight (assume AM/PM based on hour heuristic)
      // We'll interpret 1-6 as PM for school context.
      const [hh, mm] = t.split(":").map(Number);
      let h = hh;
      if (h >= 1 && h <= 6) h += 12; // 1pm-6pm
      return h * 60 + (mm||0);
    }
    function parseRange(range){
      // "9:15-10:10" -> {start,end} in minutes
      const parts = range.split("-");
      if (parts.length !== 2) return null;
      return { start: parseTimeToMinutes(parts[0].trim()), end: parseTimeToMinutes(parts[1].trim()) };
    }

    /************************************************************
     * LOCAL STORAGE STATE
     ************************************************************/
    const LS_KEY = "geffen_cockpit_v1";

    const defaultState = {
      blueAnchor: "",                 // YYYY-MM-DD (Monday that is Blue)
      officeHoursMode: "none",         // none | blue | gold | both
      blocks: { A:"",B:"",C:"",D:"",E:"",F:"",G:"",H:"" },
      checklist: []                    // {text, done, created}
    };

    function loadState(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if (!raw) return structuredClone(defaultState);
        const obj = JSON.parse(raw);
        return {
          ...structuredClone(defaultState),
          ...obj,
          blocks: { ...structuredClone(defaultState.blocks), ...(obj.blocks||{}) },
          checklist: Array.isArray(obj.checklist) ? obj.checklist : []
        };
      }catch(e){
        return structuredClone(defaultState);
      }
    }
    function saveState(){
      localStorage.setItem(LS_KEY, JSON.stringify(state));
    }

    let state = loadState();

    /************************************************************
     * UI WIRING: schedule setup fields
     ************************************************************/
    const blueAnchorEl = document.getElementById("blueAnchor");
    const officeHoursModeEl = document.getElementById("officeHoursMode");
    const blockEls = ["A","B","C","D","E","F","G","H"].reduce((acc,k)=>{
      acc[k] = document.getElementById(k);
      return acc;
    }, {});
    const saveScheduleBtn = document.getElementById("saveScheduleBtn");
    const toggleSetupBtn = document.getElementById("toggleSetup");
    const setupBody = document.getElementById("setupBody");

    function hydrateSetupUI(){
      blueAnchorEl.value = state.blueAnchor || "";
      officeHoursModeEl.value = state.officeHoursMode || "none";
      for (const k of Object.keys(blockEls)){
        blockEls[k].value = state.blocks[k] || "";
      }
    }
    hydrateSetupUI();

    saveScheduleBtn.addEventListener("click", () => {
      state.blueAnchor = (blueAnchorEl.value || "").trim();
      state.officeHoursMode = officeHoursModeEl.value;

      for (const k of Object.keys(blockEls)){
        state.blocks[k] = (blockEls[k].value || "").trim();
      }
      saveState();
      renderToday();
      flashPill("Saved");
    });

    let setupCollapsed = false;
    toggleSetupBtn.addEventListener("click", () => {
      setupCollapsed = !setupCollapsed;
      setupBody.style.display = setupCollapsed ? "none" : "";
      toggleSetupBtn.textContent = setupCollapsed ? "Expand" : "Collapse";
    });

    function flashPill(msg){
      const pill = document.getElementById("dayModePill");
      const old = pill.textContent;
      pill.textContent = msg;
      setTimeout(()=> pill.textContent = old, 900);
    }

    /************************************************************
     * CHECKLIST
     ************************************************************/
    const checklistEl = document.getElementById("checklist");
    const newItemEl = document.getElementById("newItem");
    const addItemBtn = document.getElementById("addItemBtn");
    const clearCheckedBtn = document.getElementById("clearCheckedBtn");

    function renderChecklist(){
      checklistEl.innerHTML = "";
      if (!state.checklist.length){
        const d = document.createElement("div");
        d.className = "tinyHint";
        d.textContent = "No items yet.";
        checklistEl.appendChild(d);
        renderHolo();
        return;
      }

      const grid = document.createElement("div");
      grid.style.display = "grid";
      grid.style.gap = "8px";

      state.checklist.forEach((item, idx) => {
        const row = document.createElement("label");
        row.className = "checkItem";
        row.style.cursor = "pointer";

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = !!item.done;
        cb.addEventListener("change", () => {
          state.checklist[idx].done = cb.checked;
          saveState();
          renderChecklist();
          renderToday(); // energy / holo may depend on done state
        });

        const span = document.createElement("span");
        span.textContent = item.text || "";
        if (item.done){
          span.style.textDecoration = "line-through";
          span.style.opacity = ".65";
        }

        row.appendChild(cb);
        row.appendChild(span);
        grid.appendChild(row);
      });

      checklistEl.appendChild(grid);
      renderHolo();
    }

    function addChecklistItem(text){
      const t = (text||"").trim();
      if (!t) return;
      state.checklist.unshift({ text: t, done:false, created: Date.now() });
      saveState();
      newItemEl.value = "";
      renderChecklist();
      renderToday();
    }

    addItemBtn.addEventListener("click", () => addChecklistItem(newItemEl.value));
    newItemEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter"){
        e.preventDefault();
        addChecklistItem(newItemEl.value);
      }
    });

    clearCheckedBtn.addEventListener("click", () => {
      state.checklist = state.checklist.filter(it => !it.done);
      saveState();
      renderChecklist();
      renderToday();
    });

    renderChecklist();

    /************************************************************
     * HOLO LIST (read-only feed inside ring)
     ************************************************************/
    const holoList = document.getElementById("holoList");
    const holoStatus = document.getElementById("holoStatus");

    function renderHolo(){
      const items = state.checklist.slice(0, 6);
      holoList.innerHTML = "";

      if (!items.length){
        holoStatus.textContent = "No items";
        holoList.innerHTML = `<div class="line"><div class="dot"></div><div>Nothing yet. Add items on the right.</div></div>`;
        return;
      }

      const doneCount = state.checklist.filter(i => i.done).length;
      holoStatus.textContent = `${doneCount}/${state.checklist.length} complete`;

      items.forEach(it => {
        const line = document.createElement("div");
        line.className = "line" + (it.done ? " done" : "");
        line.innerHTML = `<div class="dot"></div><div style="overflow:hidden;text-overflow:ellipsis;">${escapeHtml(it.text)}</div>`;
        holoList.appendChild(line);
      });
    }
    function escapeHtml(s){
      return String(s||"")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    renderHolo();

    /************************************************************
     * BLUE/GOLD AUTO MODE (anchor-date based)
     ************************************************************/
    const weekModeEl = document.getElementById("weekMode");
    const dayModePill = document.getElementById("dayModePill");

    function isoDate(d){
      const y = d.getFullYear();
      const m = pad2(d.getMonth()+1);
      const da = pad2(d.getDate());
      return `${y}-${m}-${da}`;
    }

    function isValidISODate(s){
      return /^\d{4}-\d{2}-\d{2}$/.test(s);
    }

    function getWeekModeForDate(date){
      const forced = weekModeEl.value;
      if (forced === "blue" || forced === "gold") return forced;

      // auto:
      if (!isValidISODate(state.blueAnchor)) return null;

      // anchor should be a Monday that's Blue.
      const anchor = new Date(state.blueAnchor + "T00:00:00");
      const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());

      // compute Monday of each week for both dates
      const toMonday = (x) => {
        const dd = new Date(x.getFullYear(), x.getMonth(), x.getDate());
        const dow = dd.getDay(); // 0..6
        const diff = (dow + 6) % 7; // days since Monday
        dd.setDate(dd.getDate() - diff);
        return dd;
      };

      const aMon = toMonday(anchor);
      const dMon = toMonday(d);

      const weeksDiff = Math.round((dMon - aMon) / (7*24*60*60*1000));
      // Even weeks from anchor = Blue, odd = Gold
      return (weeksDiff % 2 === 0) ? "blue" : "gold";
    }

    /************************************************************
     * Render today's schedule + energy bar progress
     ************************************************************/
    const todayScheduleEl = document.getElementById("todaySchedule");
    const todayHintEl = document.getElementById("todayHint");
    const energyFill = document.getElementById("energyFill");
    const energyPct = document.getElementById("energyPct");
    const energyNote = document.getElementById("energyNote");

    function dayKeyFromDate(d){
      return dayKeys[d.getDay()];
    }

    function blockLabel(block){
      const lunchish = [
        "MS/US Lunch +MS/US Clubs",
        "MS/US SuperLunch +Affinity Groups",
        "H/X1",
        "X3",
        "Educators’ Mtg.",
        "Reading Period",
        "Bulletin"
      ];
      if (lunchish.includes(block)) return block;

      // H office hours override
      if (block === "H"){
        const w = getWeekModeForDate(new Date());
        const mode = state.officeHoursMode || "none";
        if ((mode === "both") ||
            (mode === "blue" && w === "blue") ||
            (mode === "gold" && w === "gold")){
          return "Office Hours";
        }
      }

      return state.blocks[block] ? `${state.blocks[block]} (${block})` : block;
    }

    function buildTodayPeriods(){
      const now = new Date();
      const dk = dayKeyFromDate(now);
      if (dk === "sunday" || dk === "saturday") return { periods: [], week:null, day:dk };

      const week = getWeekModeForDate(now);
      if (!week) return { periods: [], week:null, day:dk };

      const src = scheduleByWeek[week]?.[dk] || [];
      const periods = src.map(p => {
        const range = parseRange(p.time);
        return { ...p, label: blockLabel(p.block), range };
      }).filter(p => p.range);

      return { periods, week, day:dk };
    }

    function renderToday(){
      const now = new Date();
      const { periods, week, day } = buildTodayPeriods();

      const dayName = day.charAt(0).toUpperCase() + day.slice(1);
      const weekName = week ? week.toUpperCase() : "—";

      if (!week && (day === "saturday" || day === "sunday")){
        dayModePill.textContent = `Weekend • ${dayName}`;
      } else if (!week){
        dayModePill.textContent = `Auto needs anchor date`;
      } else {
        dayModePill.textContent = `${weekName} • ${dayName}`;
      }

      todayScheduleEl.innerHTML = "";

      if (!periods.length){
        const row = document.createElement("div");
        row.className = "period";
        row.innerHTML = `
          <div class="l">
            <b>${(day === "saturday" || day === "sunday") ? "Weekend" : "Schedule not ready"}</b>
            <span>${(day === "saturday" || day === "sunday") ? "No school blocks today." : "Set a Blue anchor date + save your blocks in Schedule Setup."}</span>
          </div>
          <div class="r">—</div>
        `;
        todayScheduleEl.appendChild(row);

        // energy
        energyFill.style.width = "0%";
        energyPct.textContent = "0%";
        energyNote.textContent = (day === "saturday" || day === "sunday") ? "Standby" : "Awaiting schedule…";
        return;
      }

      // mark current period
      const minutesNow = now.getHours()*60 + now.getMinutes() + now.getSeconds()/60;

      let lastEnd = Math.max(...periods.map(p => p.range.end));
      let firstStart = Math.min(...periods.map(p => p.range.start));

      let active = null;
      periods.forEach(p => {
        const el = document.createElement("div");
        const isNow = minutesNow >= p.range.start && minutesNow < p.range.end;
        if (isNow) active = p;

        el.className = "period" + (isNow ? " now" : "");
        el.innerHTML = `
          <div class="l">
            <b>${escapeHtml(p.label)}</b>
            <span>${escapeHtml(p.block)}</span>
          </div>
          <div class="r">${escapeHtml(p.time)}</div>
        `;
        todayScheduleEl.appendChild(el);
      });

      // energy progress: from firstStart -> lastEnd
      const clamped = Math.min(Math.max(minutesNow, firstStart), lastEnd);
      const prog = (clamped - firstStart) / (lastEnd - firstStart);
      const pct = Math.round(prog * 100);

      energyFill.style.width = `${pct}%`;
      energyPct.textContent = `${pct}%`;

      if (minutesNow < firstStart){
        energyNote.textContent = "Pre-start";
      } else if (minutesNow >= lastEnd){
        energyNote.textContent = "Complete";
      } else if (active){
        energyNote.textContent = `Now: ${active.block}`;
      } else {
        energyNote.textContent = "In transit";
      }

      // update hint text based on anchor presence
      todayHintEl.textContent = (weekModeEl.value === "auto")
        ? (isValidISODate(state.blueAnchor)
            ? `Auto week mode anchored to Blue Monday: ${state.blueAnchor}.`
            : `Auto mode needs a “Blue anchor date” (a Monday you know is Blue).`)
        : `Week mode forced to ${weekModeEl.value.toUpperCase()}.`;
    }

    weekModeEl.addEventListener("change", () => {
      renderToday();
    });

    // keep energy + now highlighting fresh
    setInterval(renderToday, 1500);
    renderToday();

    /************************************************************
     * EXPORT / IMPORT JSON
     ************************************************************/
    const overlay = document.getElementById("overlay");
    const modalTitle = document.getElementById("modalTitle");
    const modalHint = document.getElementById("modalHint");
    const jsonBox = document.getElementById("jsonBox");
    const closeModal = document.getElementById("closeModal");
    const copyJsonBtn = document.getElementById("copyJsonBtn");
    const applyJsonBtn = document.getElementById("applyJsonBtn");
    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");

    function openModal(mode){
      overlay.style.display = "flex";
      if (mode === "export"){
        modalTitle.textContent = "Export";
        modalHint.textContent = "Copy this JSON to move your setup + checklist to another computer.";
        jsonBox.value = JSON.stringify(state, null, 2);
        applyJsonBtn.style.display = "none";
        jsonBox.readOnly = true;
      } else {
        modalTitle.textContent = "Import";
        modalHint.textContent = "Paste JSON (exported from this dashboard) and click Apply.";
        jsonBox.value = "";
        applyJsonBtn.style.display = "";
        jsonBox.readOnly = false;
      }
    }
    function closeModalFn(){
      overlay.style.display = "none";
    }

    exportBtn.addEventListener("click", () => openModal("export"));
    importBtn.addEventListener("click", () => openModal("import"));
    closeModal.addEventListener("click", closeModalFn);
    overlay.addEventListener("click", (e) => {
      if (e.target === overlay) closeModalFn();
    });

    copyJsonBtn.addEventListener("click", async () => {
      try{
        await navigator.clipboard.writeText(jsonBox.value);
        flashPill("Copied");
      }catch(e){
        jsonBox.select();
        document.execCommand("copy");
        flashPill("Copied");
      }
    });

    applyJsonBtn.addEventListener("click", () => {
      try{
        const obj = JSON.parse(jsonBox.value);
        // basic shape guard
        if (typeof obj !== "object" || !obj) throw new Error("Invalid JSON");

        state = {
          ...structuredClone(defaultState),
          ...obj,
          blocks: { ...structuredClone(defaultState.blocks), ...(obj.blocks||{}) },
          checklist: Array.isArray(obj.checklist) ? obj.checklist : []
        };

        saveState();
        hydrateSetupUI();
        renderChecklist();
        renderToday();
        closeModalFn();
        flashPill("Imported");
      }catch(e){
        alert("Import failed. Make sure you pasted valid JSON exported from this dashboard.");
      }
    });

    /************************************************************
     * Small UX touches
     ************************************************************/
    // focus Google search with /
    window.addEventListener("keydown", (e) => {
      if (e.key === "/" && document.activeElement !== document.getElementById("googleQ") && document.activeElement !== newItemEl){
        e.preventDefault();
        document.getElementById("googleQ").focus();
      }
    });

    // keep ring layout stable on resize
    window.addEventListener("resize", () => layoutNodes());

    // initial focus: none (cockpit vibe)
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ari’s Daily Dashboard</title>
  <style>
    :root{
      /* Futuristic blue + metallic */
      --bg0:#060A18;
      --bg1:#0A1230;
      --bg2:#0C1A3F;

      --ink:#EAF2FF;
      --muted:#A9B6D6;

      --cobalt:#2D7DFF;
      --cobalt2:#1E5BFF;
      --cyan:#49D7FF;

      --steel:#9FB1C9;
      --steel2:#6C7E9A;
      --gun:#141C2D;

      --brass:#D9B04C;
      --brass2:#9B7A2A;

      --danger:#FF5A5A;
      --ok:#7CFFB2;

      --shadow: 0 24px 80px rgba(0,0,0,.55);
      --shadow2: 0 10px 28px rgba(0,0,0,.35);
      --ring: 0 0 0 1px rgba(155, 188, 255, .18), 0 0 0 6px rgba(45,125,255,.10), 0 18px 60px rgba(0,0,0,.55);

      --radius: 18px;
      --radius2: 26px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      --serif: ui-serif, Georgia, "Times New Roman", Times, serif;

      --hubSize: 680px; /* desktop */
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--ink);
      background:
        radial-gradient(1100px 560px at 18% 12%, rgba(45,125,255,.16), transparent 60%),
        radial-gradient(900px 520px at 84% 18%, rgba(73,215,255,.12), transparent 55%),
        radial-gradient(800px 520px at 54% 86%, rgba(217,176,76,.10), transparent 55%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 44%, var(--bg2));
      overflow-x:hidden;
    }

    /* Subtle scanlines + bloom */
    .fx{
      position:fixed; inset:0;
      pointer-events:none;
      z-index: 3;
      background:
        repeating-linear-gradient(
          to bottom,
          rgba(255,255,255,.035) 0px,
          rgba(255,255,255,.035) 1px,
          rgba(0,0,0,0) 2px,
          rgba(0,0,0,0) 4px
        );
      opacity:.10;
      mix-blend-mode: overlay;
    }
    .vignette{
      position:fixed; inset:0;
      pointer-events:none;
      z-index: 2;
      background:
        radial-gradient(900px 650px at 50% 18%, rgba(0,0,0,0), rgba(0,0,0,.42) 70%, rgba(0,0,0,.66) 100%);
    }
    .stars{
      position:fixed; inset:0;
      pointer-events:none;
      z-index: 0;
      background-image:
        radial-gradient(circle at 12% 14%, rgba(255,255,255,.85) 0 1px, transparent 2px),
        radial-gradient(circle at 22% 34%, rgba(255,255,255,.55) 0 1px, transparent 2px),
        radial-gradient(circle at 64% 22%, rgba(255,255,255,.70) 0 1px, transparent 2px),
        radial-gradient(circle at 80% 18%, rgba(255,255,255,.60) 0 1px, transparent 2px),
        radial-gradient(circle at 40% 62%, rgba(255,255,255,.55) 0 1px, transparent 2px),
        radial-gradient(circle at 74% 64%, rgba(255,255,255,.35) 0 1px, transparent 2px),
        radial-gradient(circle at 88% 74%, rgba(255,255,255,.35) 0 1px, transparent 2px);
      opacity:.18;
      filter: blur(.2px);
      animation: twinkle 6.5s ease-in-out infinite;
    }
    @keyframes twinkle{
      0%,100%{ opacity:.15; transform: translateY(0); }
      50%{ opacity:.22; transform: translateY(-2px); }
    }

    /* “Landscape” silhouettes: cinematic, FF7-ish, not literal */
    .landscape{
      position:fixed;
      inset: 0;
      z-index: 1;
      pointer-events:none;
      overflow:hidden;
    }
    .layer{
      position:absolute;
      left: -6%;
      width: 112%;
      height: 55%;
      bottom: -6%;
      filter: drop-shadow(0 22px 60px rgba(0,0,0,.65));
      opacity: .95;
      transform: translateZ(0);
    }
    .layer svg{ width:100%; height:100%; display:block; }
    .layer.back{ bottom: 22%; opacity:.38; filter: blur(.2px) drop-shadow(0 18px 50px rgba(0,0,0,.55)); }
    .layer.mid{ bottom: 10%; opacity:.50; }
    .layer.front{ bottom: -6%; opacity:.72; }

    .steam{
      position:absolute;
      width: 320px;
      height: 140px;
      border-radius: 999px;
      background: radial-gradient(closest-side, rgba(73,215,255,.18), rgba(73,215,255,0));
      filter: blur(10px);
      opacity:.35;
      animation: drift 18s linear infinite;
      mix-blend-mode: screen;
    }
    .steam.s1{ left: 8%; bottom: 26%; animation-duration: 22s; }
    .steam.s2{ left: 66%; bottom: 32%; animation-duration: 26s; opacity:.25; }
    .steam.s3{ left: 40%; bottom: 18%; animation-duration: 30s; opacity:.22; }
    @keyframes drift{
      0%{ transform: translateX(-10px) translateY(0) scale(1); }
      50%{ transform: translateX(120px) translateY(-18px) scale(1.08); }
      100%{ transform: translateX(260px) translateY(-8px) scale(1.12); }
    }

    header{
      position:relative;
      z-index: 5;
      max-width: 1220px;
      margin: 18px auto 8px auto;
      padding: 0 18px;
      display:flex;
      align-items: flex-end;
      justify-content: space-between;
      gap: 14px;
      flex-wrap:wrap;
    }
    .brand{
      display:flex;
      flex-direction: column;
      gap: 6px;
    }
    .brand h1{
      margin:0;
      font-family: var(--serif);
      letter-spacing:.4px;
      font-weight: 800;
      font-size: 24px;
      line-height:1.1;
      color: #EAF2FF;
      text-shadow: 0 0 22px rgba(45,125,255,.25);
    }
    .brand .sub{
      font-size: 12px;
      color: var(--muted);
      letter-spacing:.03em;
    }

    .topright{
      display:flex;
      align-items:center;
      gap: 10px;
      flex-wrap: wrap;
      justify-content:flex-end;
    }
    .chip{
      display:inline-flex;
      align-items:center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: 999px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border: 1px solid rgba(155,188,255,.18);
      box-shadow: var(--shadow2);
      backdrop-filter: blur(10px);
      font-weight: 800;
      letter-spacing:.02em;
      user-select:none;
    }
    .chip .mut{ color: var(--muted); font-weight: 700; }
    .chip input[type="date"]{
      background: transparent;
      border: none;
      color: var(--ink);
      font-family: var(--mono);
      font-weight: 800;
      outline:none;
    }
    .chip select{
      background: transparent;
      border: none;
      color: var(--ink);
      font-weight: 900;
      outline:none;
      cursor:pointer;
    }
    .chip button{
      background: transparent;
      border: 1px solid rgba(155,188,255,.22);
      color: var(--ink);
      padding: 7px 10px;
      border-radius: 999px;
      cursor:pointer;
      font-weight: 900;
      transition: transform .06s ease, border-color .15s ease, background .15s ease;
    }
    .chip button:hover{
      border-color: rgba(73,215,255,.40);
      background: rgba(73,215,255,.08);
    }
    .chip button:active{ transform: translateY(1px); }

    main{
      position:relative;
      z-index: 5;
      max-width: 1220px;
      margin: 10px auto 34px auto;
      padding: 0 18px;
      display:grid;
      grid-template-columns: 1.35fr 1fr;
      gap: 16px;
      align-items: start;
    }
    @media (max-width: 1050px){
      :root{ --hubSize: 640px; }
      main{ grid-template-columns: 1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border: 1px solid rgba(155,188,255,.18);
      border-radius: var(--radius2);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .card .hd{
      padding: 14px 14px 10px 14px;
      border-bottom: 1px solid rgba(155,188,255,.14);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 10px;
    }
    .card .hd h2{
      margin:0;
      font-size: 13px;
      letter-spacing:.10em;
      text-transform: uppercase;
      font-weight: 900;
      color: rgba(234,242,255,.92);
    }
    .card .hd .sub{
      margin-top:6px;
      font-size: 12px;
      color: var(--muted);
      line-height:1.25;
    }
    .card .bd{ padding: 14px; }

    /* HUB */
    .hubWrap{
      padding: 14px;
    }
    .hub{
      width: min(var(--hubSize), 100%);
      aspect-ratio: 1 / 1;
      margin: 0 auto;
      position: relative;
    }

    .orbital{
      position:absolute;
      inset: 0;
      border-radius: 999px;
      background:
        radial-gradient(circle at 50% 50%, rgba(73,215,255,.06), transparent 52%),
        radial-gradient(circle at 50% 50%, rgba(45,125,255,.10), transparent 58%),
        radial-gradient(circle at 50% 50%, rgba(217,176,76,.10), transparent 68%);
      border: 1px solid rgba(155,188,255,.10);
      box-shadow: 0 0 0 1px rgba(0,0,0,.35) inset;
      overflow:hidden;
    }
    .orbital:before{
      content:"";
      position:absolute; inset: -40%;
      background:
        conic-gradient(from 90deg,
          rgba(73,215,255,.0),
          rgba(73,215,255,.10),
          rgba(217,176,76,.10),
          rgba(73,215,255,.0)
        );
      opacity:.65;
      animation: slowspin 26s linear infinite;
      filter: blur(8px);
    }
    @keyframes slowspin{
      from{ transform: rotate(0deg); }
      to{ transform: rotate(360deg); }
    }

    .ringStroke{
      position:absolute; inset: 7%;
      border-radius: 999px;
      border: 1px solid rgba(155,188,255,.14);
      box-shadow: 0 0 0 1px rgba(0,0,0,.35) inset, 0 0 60px rgba(45,125,255,.12);
      pointer-events:none;
    }
    .ringStroke2{
      position:absolute; inset: 18%;
      border-radius: 999px;
      border: 1px dashed rgba(155,188,255,.12);
      box-shadow: 0 0 0 1px rgba(0,0,0,.25) inset;
      pointer-events:none;
      opacity:.7;
    }

    .core{
      position:absolute;
      inset: 26%;
      border-radius: 999px;
      background:
        radial-gradient(circle at 50% 40%, rgba(255,255,255,.12), rgba(255,255,255,.02) 55%, rgba(0,0,0,.18) 100%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(155,188,255,.18);
      box-shadow: 0 0 0 6px rgba(45,125,255,.10), 0 24px 80px rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      display:flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 18px;
      text-align:center;
      user-select:none;
    }
    .core .title{
      font-family: var(--serif);
      font-weight: 900;
      font-size: 22px;
      letter-spacing:.4px;
      margin:0;
      color: rgba(234,242,255,.96);
      text-shadow: 0 0 22px rgba(45,125,255,.22);
    }
    .core .meta{
      margin-top: 8px;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
    }
    .core .now{
      margin-top: 12px;
      display:flex;
      gap: 10px;
      justify-content:center;
      flex-wrap: wrap;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 10px;
      border-radius: 999px;
      border: 1px solid rgba(155,188,255,.18);
      background: rgba(0,0,0,.18);
      box-shadow: var(--shadow2);
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(234,242,255,.92);
    }
    .pill b{ font-family: var(--sans); letter-spacing:.02em; }

    /* Link nodes */
    .node{
      position:absolute;
      left:50%;
      top:50%;
      width: 168px;
      transform: translate(-50%,-50%);
      border-radius: 18px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
      border: 1px solid rgba(155,188,255,.18);
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
      padding: 10px 10px 10px 10px;
      cursor:pointer;
      user-select:none;
      transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease, background .14s ease, opacity .14s ease;
      backdrop-filter: blur(10px);
      overflow:hidden;
    }
    .node:before{
      content:"";
      position:absolute;
      inset:-60px;
      background:
        radial-gradient(circle at 30% 30%, rgba(73,215,255,.22), transparent 55%),
        radial-gradient(circle at 80% 20%, rgba(217,176,76,.16), transparent 55%),
        radial-gradient(circle at 55% 85%, rgba(45,125,255,.18), transparent 55%);
      opacity:.55;
      filter: blur(10px);
      transform: translateZ(0);
    }
    .node .row{
      position:relative;
      display:flex;
      gap: 10px;
      align-items:center;
    }
    .node .icon{
      width: 38px; height: 38px;
      border-radius: 12px;
      background:
        linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04));
      border: 1px solid rgba(155,188,255,.18);
      display:grid;
      place-items:center;
      box-shadow: 0 10px 22px rgba(0,0,0,.35);
      flex: 0 0 auto;
    }
    .node .icon svg{ width: 22px; height:22px; opacity:.92; }
    .node .name{
      font-weight: 950;
      letter-spacing:.02em;
      font-size: 13px;
      line-height:1.1;
    }
    .node .desc{
      position:relative;
      margin-top: 6px;
      font-size: 11px;
      color: var(--muted);
      line-height:1.2;
    }
    .node.selected{
      border-color: rgba(73,215,255,.46);
      box-shadow: 0 0 0 6px rgba(73,215,255,.10), 0 24px 80px rgba(0,0,0,.62);
    }

    /* Crank */
    .crankDock{
      position:absolute;
      right: -6px;
      top: 50%;
      transform: translateY(-50%);
      width: 180px;
      height: 320px;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
    }
    .crank{
      pointer-events:auto;
      width: 150px;
      height: 150px;
      border-radius: 999px;
      position:relative;
      background:
        radial-gradient(circle at 40% 35%, rgba(255,255,255,.18), rgba(255,255,255,.04) 55%, rgba(0,0,0,.28) 100%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border: 1px solid rgba(155,188,255,.20);
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      cursor: grab;
      user-select:none;
      touch-action:none;
    }
    .crank:active{ cursor: grabbing; }
    .crank:before{
      content:"";
      position:absolute; inset: 12px;
      border-radius: 999px;
      border: 1px dashed rgba(155,188,255,.14);
      opacity:.9;
    }
    .crank .hubcap{
      position:absolute; inset: 34px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 50% 40%, rgba(73,215,255,.14), rgba(0,0,0,.24) 70%),
        linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border: 1px solid rgba(155,188,255,.18);
      box-shadow: 0 0 0 6px rgba(45,125,255,.10);
      display:grid; place-items:center;
      font-family: var(--mono);
      font-size: 11px;
      color: var(--muted);
      letter-spacing:.06em;
      text-transform:uppercase;
    }
    .crank .arm{
      position:absolute;
      left:50%; top:50%;
      width: 74px;
      height: 10px;
      transform-origin: 0% 50%;
      transform: translate(0,-50%) rotate(0deg);
      background: linear-gradient(90deg, rgba(159,177,201,.95), rgba(108,126,154,.85));
      border-radius: 999px;
      box-shadow: 0 10px 18px rgba(0,0,0,.35);
      border: 1px solid rgba(255,255,255,.14);
    }
    .crank .knob{
      position:absolute;
      right: -12px;
      top: 50%;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      border-radius: 999px;
      background:
        radial-gradient(circle at 35% 30%, rgba(255,255,255,.20), rgba(0,0,0,.28) 70%),
        linear-gradient(180deg, rgba(217,176,76,.35), rgba(155,122,42,.18));
      border: 1px solid rgba(217,176,76,.40);
      box-shadow: 0 10px 18px rgba(0,0,0,.35);
    }
    .crankHint{
      position:absolute;
      top: calc(50% + 100px);
      right: 18px;
      transform: translateY(-50%);
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(169,182,214,.88);
      opacity:.85;
      text-align:right;
      pointer-events:none;
      text-shadow: 0 0 14px rgba(45,125,255,.16);
    }

    /* Schedule / Agenda */
    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    @media (max-width: 520px){
      .grid2{ grid-template-columns: 1fr; }
      .node{ width: 154px; }
      .crankDock{ display:none; }
    }

    label{
      display:block;
      margin-bottom: 6px;
      font-size: 12px;
      color: var(--muted);
      letter-spacing:.02em;
      font-weight: 800;
    }
    input[type="text"], textarea, select{
      width:100%;
      padding: 10px 10px;
      border-radius: 14px;
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(155,188,255,.18);
      color: var(--ink);
      outline:none;
      box-shadow: 0 0 0 0 rgba(73,215,255,0);
      transition: box-shadow .15s ease, border-color .15s ease, transform .06s ease;
    }
    input[type="text"]:focus, textarea:focus, select:focus{
      border-color: rgba(73,215,255,.46);
      box-shadow: 0 0 0 5px rgba(73,215,255,.10);
    }
    textarea{
      min-height: 110px;
      resize: vertical;
      font-family: var(--mono);
      font-size: 12px;
      line-height: 1.35;
    }
    .btnrow{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .btn{
      border:none;
      padding: 10px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 950;
      letter-spacing:.02em;
      transition: transform .06s ease, filter .15s ease, background .15s ease, border-color .15s ease;
      user-select:none;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      color:#071022;
      background: linear-gradient(180deg, rgba(73,215,255,.95), rgba(45,125,255,.95));
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
    }
    .btn.ghost{
      color: var(--ink);
      background: rgba(0,0,0,.18);
      border: 1px solid rgba(155,188,255,.18);
    }
    .btn.warn{
      color:#230A0A;
      background: linear-gradient(180deg, rgba(255,90,90,.92), rgba(217,40,40,.85));
      box-shadow: 0 18px 60px rgba(0,0,0,.45);
    }

    .hint{
      margin-top: 8px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.35;
    }

    .daySchedule{
      margin-top: 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(155,188,255,.14);
      overflow:hidden;
    }
    .daySchedule .row{
      display:grid;
      grid-template-columns: 92px 1fr;
      gap: 10px;
      padding: 10px 12px;
      border-bottom: 1px solid rgba(155,188,255,.12);
      background: rgba(0,0,0,.14);
    }
    .daySchedule .row:last-child{ border-bottom:none; }
    .daySchedule .time{
      font-family: var(--mono);
      font-size: 12px;
      color: rgba(234,242,255,.88);
      font-weight: 900;
      white-space: nowrap;
    }
    .daySchedule .what{
      font-size: 13px;
      font-weight: 900;
      letter-spacing:.01em;
      display:flex;
      gap: 10px;
      align-items: baseline;
      flex-wrap: wrap;
    }
    .tag{
      font-family: var(--mono);
      font-size: 11px;
      color: rgba(169,182,214,.92);
      border: 1px solid rgba(155,188,255,.16);
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(0,0,0,.18);
    }
    .row.classRow{
      background: linear-gradient(180deg, rgba(45,125,255,.10), rgba(0,0,0,.14));
    }
    .row.endcap{
      background: linear-gradient(180deg, rgba(217,176,76,.10), rgba(0,0,0,.14));
    }

    /* Energy Grid */
    .energyWrap{
      margin-top: 12px;
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid rgba(155,188,255,.14);
      background: rgba(0,0,0,.14);
    }
    .energyTop{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    .energyTop .title{
      font-weight: 950;
      letter-spacing:.03em;
      text-transform: uppercase;
      font-size: 12px;
      color: rgba(234,242,255,.92);
    }
    .energyTop .pct{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      font-weight: 900;
    }
    .cells{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 6px;
    }
    .cell{
      aspect-ratio: 1 / 1;
      border-radius: 8px;
      border: 1px solid rgba(155,188,255,.14);
      background: rgba(0,0,0,.18);
      box-shadow: 0 10px 18px rgba(0,0,0,.22) inset;
      transition: transform .2s ease, filter .25s ease, background .25s ease, border-color .25s ease;
      position:relative;
      overflow:hidden;
    }
    .cell:before{
      content:"";
      position:absolute; inset:-30%;
      background: radial-gradient(circle at 30% 30%, rgba(73,215,255,.24), transparent 55%);
      opacity:0;
      filter: blur(10px);
      transition: opacity .25s ease;
    }
    .cell.on{
      background: linear-gradient(180deg, rgba(73,215,255,.38), rgba(45,125,255,.22));
      border-color: rgba(73,215,255,.36);
      filter: drop-shadow(0 0 10px rgba(73,215,255,.12));
    }
    .cell.on:before{ opacity:.85; }
    .cell.pulse{
      transform: translateY(-1px);
    }

    footer{
      position:relative;
      z-index: 5;
      max-width: 1220px;
      margin: 0 auto 26px auto;
      padding: 0 18px;
      color: rgba(169,182,214,.82);
      font-size: 12px;
      line-height: 1.4;
      display:flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    .kbd{
      font-family: var(--mono);
      border: 1px solid rgba(155,188,255,.18);
      border-radius: 8px;
      padding: 2px 6px;
      background: rgba(0,0,0,.18);
      color: rgba(234,242,255,.90);
      font-weight: 900;
    }

    a{ color: inherit; text-decoration:none; }
  </style>
</head>

<body>
  <div class="stars"></div>
  <div class="landscape" aria-hidden="true">
    <div class="steam s1"></div>
    <div class="steam s2"></div>
    <div class="steam s3"></div>

    <div class="layer back">
      <svg viewBox="0 0 1200 500" preserveAspectRatio="none">
        <path d="M0,330 C120,290 220,260 330,280 C440,305 520,235 640,250 C760,265 820,210 920,235 C1020,260 1110,210 1200,230 L1200,500 L0,500 Z"
              fill="rgba(45,125,255,.12)"/>
        <path d="M0,360 C170,330 230,300 360,320 C500,340 540,290 680,300 C820,310 860,270 960,280 C1080,292 1120,260 1200,268 L1200,500 L0,500 Z"
              fill="rgba(159,177,201,.10)"/>
      </svg>
    </div>

    <div class="layer mid">
      <svg viewBox="0 0 1200 500" preserveAspectRatio="none">
        <path d="M0,350 C140,300 260,290 360,320 C470,355 560,270 700,292 C845,315 910,250 1020,272 C1110,292 1150,260 1200,270 L1200,500 L0,500 Z"
              fill="rgba(18,28,48,.78)"/>
        <path d="M920,190 L990,190 L990,330 L920,330 Z" fill="rgba(217,176,76,.10)"/>
        <path d="M950,130 L980,130 L980,190 L950,190 Z" fill="rgba(217,176,76,.12)"/>
      </svg>
    </div>

    <div class="layer front">
      <svg viewBox="0 0 1200 500" preserveAspectRatio="none">
        <path d="M0,380 C170,340 300,330 410,360 C540,400 640,305 770,330 C900,354 980,305 1090,320 C1150,330 1170,315 1200,315 L1200,500 L0,500 Z"
              fill="rgba(8,12,24,.95)"/>
        <path d="M160,310 L220,310 L220,500 L160,500 Z" fill="rgba(217,176,76,.10)"/>
        <path d="M186,250 L198,250 L198,310 L186,310 Z" fill="rgba(217,176,76,.15)"/>
      </svg>
    </div>
  </div>

  <div class="vignette"></div>
  <div class="fx"></div>

  <header>
    <div class="brand">
      <h1>GEFFEN FIELD TERMINAL</h1>
      <div class="sub">Daily dashboard. Circular hub. Local-only saves. Futuristic-blue + steel.</div>
    </div>

    <div class="topright">
      <div class="chip" title="Pick the day you’re running. Everything saves locally.">
        <span class="mut">DATE</span>
        <input type="date" id="dashDate" />
        <span class="mut">WEEK</span>
        <select id="weekMode">
          <option value="auto">AUTO</option>
          <option value="blue">BLUE</option>
          <option value="gold">GOLD</option>
        </select>
        <button id="todayBtn" type="button">TODAY</button>
      </div>

      <div class="chip" title="Schedule anchor: pick a known day and whether it was Blue or Gold. AUTO uses this to compute weeks.">
        <span class="mut">ANCHOR</span>
        <input type="date" id="anchorDate" />
        <select id="anchorWeek">
          <option value="blue">BLUE</option>
          <option value="gold">GOLD</option>
        </select>
        <button id="saveAnchorBtn" type="button">SAVE</button>
      </div>
    </div>
  </header>

  <main>
    <!-- LEFT: HUB -->
    <section class="card">
      <div class="hd">
        <div>
          <h2>Ring Hub</h2>
          <div class="sub">Turn the crank to rotate tools. Click a node to open. Arrow keys rotate. Enter opens selected.</div>
        </div>
        <div class="sub" style="text-align:right;">
          <span class="kbd">←</span>/<span class="kbd">→</span> rotate · <span class="kbd">Enter</span> open · <span class="kbd">Esc</span> close panels
        </div>
      </div>

      <div class="bd hubWrap">
        <div class="hub" id="hub">
          <div class="orbital"></div>
          <div class="ringStroke"></div>
          <div class="ringStroke2"></div>

          <div class="core">
            <div class="title">OPERATIONS CORE</div>
            <div class="meta" id="coreMeta">
              —<br/>—
            </div>

            <div class="now">
              <div class="pill"><span class="muted">NOW</span> <b id="nowLabel">—</b></div>
              <div class="pill"><span class="muted">NEXT</span> <b id="nextLabel">—</b></div>
            </div>

            <div class="energyWrap" style="width:100%; margin-top: 14px;">
              <div class="energyTop">
                <div class="title">Energy Grid</div>
                <div class="pct" id="energyPct">—</div>
              </div>
              <div class="cells" id="cells"></div>
              <div class="hint" id="energyHint" style="margin-top:10px;">
                Progress is tied to today’s instructional blocks. It breathes, but converges.
              </div>
            </div>
          </div>

          <!-- Nodes injected by JS -->
          <div class="crankDock">
            <div class="crank" id="crank" title="Click-drag to rotate. (Wheel and arrow keys also work.)">
              <div class="hubcap">CRANK</div>
              <div class="arm" id="crankArm"><div class="knob"></div></div>
            </div>
          </div>
          <div class="crankHint">TURN THE CRANK<br/><span style="opacity:.7">rotate tools</span></div>
        </div>
      </div>
    </section>

    <!-- RIGHT: SCHEDULE / AGENDA -->
    <section class="card">
      <div class="hd">
        <div>
          <h2>Daily Schedule + Agenda</h2>
          <div class="sub">Enter block names + office hours once; add day notes per date. Everything saves locally.</div>
        </div>
        <div class="sub" style="text-align:right;">
          <span class="kbd">Ctrl</span>+<span class="kbd">S</span> save · <span class="kbd">Ctrl</span>+<span class="kbd">E</span> export · <span class="kbd">Ctrl</span>+<span class="kbd">I</span> import
        </div>
      </div>

      <div class="bd">
        <div class="grid2">
          <div>
            <label>Block Names (A–H)</label>
            <div class="grid2">
              <input id="blkA" type="text" placeholder="A Block" />
              <input id="blkB" type="text" placeholder="B Block" />
              <input id="blkC" type="text" placeholder="C Block" />
              <input id="blkD" type="text" placeholder="D Block" />
              <input id="blkE" type="text" placeholder="E Block" />
              <input id="blkF" type="text" placeholder="F Block" />
              <input id="blkG" type="text" placeholder="G Block" />
              <input id="blkH" type="text" placeholder="H Block" />
            </div>

            <div class="hint" style="margin-top:10px;">
              Tip: You can leave blank blocks unnamed. They’ll display as letters.
            </div>
          </div>

          <div>
            <label>H Block Office Hours (optional)</label>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 8px;">
              <div>
                <div style="font-weight:950; letter-spacing:.08em; font-size:11px; color:rgba(234,242,255,.88); text-transform:uppercase; margin: 2px 0 8px 0;">BLUE</div>
                <div id="ohBlue" style="display:grid; gap: 6px;"></div>
              </div>
              <div>
                <div style="font-weight:950; letter-spacing:.08em; font-size:11px; color:rgba(234,242,255,.88); text-transform:uppercase; margin: 2px 0 8px 0;">GOLD</div>
                <div id="ohGold" style="display:grid; gap: 6px;"></div>
              </div>
            </div>
            <div class="hint" style="margin-top:10px;">
              If checked, H will render as “Office Hours” on that week/day (unless you’ve named H as a class).
            </div>
          </div>
        </div>

        <div style="margin-top: 12px;">
          <label>Agenda Notes (saved per date)</label>
          <textarea id="agenda" placeholder="Today: goals, reminders, grading targets, quick rituals…"></textarea>

          <div class="btnrow">
            <button class="btn primary" id="saveBtn" type="button">SAVE</button>
            <button class="btn ghost" id="copyBtn" type="button">COPY DAY (TEXT)</button>
            <button class="btn ghost" id="exportBtn" type="button">EXPORT JSON</button>
            <button class="btn ghost" id="importBtn" type="button">IMPORT JSON</button>
            <button class="btn warn" id="resetBtn" type="button">RESET LOCAL</button>
            <input id="importFile" type="file" accept="application/json" style="display:none;" />
          </div>

          <div class="daySchedule" id="daySchedule"></div>
          <div class="hint" id="scheduleHint" style="margin-top:10px;">
            AUTO week uses your anchor and flips on Mondays. You can override with WEEK selector at top.
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div>
      Local-only storage. No network requests. (Links open in a new tab.)<br/>
      If AUTO week feels off, set a correct anchor date + week and hit SAVE.
    </div>
    <div>
      Wheel rotates ring. Click-drag crank rotates ring. Keyboard supported.
    </div>
  </footer>

  <script>
    /*************************
     * Links (Ring Nodes)
     *************************/
    const LINKS = [
      {
        name: "Discussion Tracker",
        desc: "Live Harkness logging",
        href: "https://amhagler.github.io/class-discussion/",
        icon: "chat"
      },
      {
        name: "Seating Chart",
        desc: "Flexible desk layouts",
        href: "https://amhagler.github.io/SC/",
        icon: "grid"
      },
      {
        name: "Rubric Builder",
        desc: "Fast grading frameworks",
        href: "https://amhagler.github.io/rubric/",
        icon: "badge"
      },
      {
        name: "Unit Calendar",
        desc: "Blue/Gold waterfall planner",
        href: "https://amhagler.github.io/uc/",
        icon: "calendar"
      },
      {
        name: "Mafia",
        desc: "Classroom party engine",
        href: "https://amhagler.github.io/mafia/",
        icon: "mask"
      },
      {
        name: "Trivia",
        desc: "GEFFEN BOWL mode",
        href: "https://amhagler.github.io/tr/",
        icon: "bolt"
      },
      {
        name: "Portal",
        desc: "MySchoolApp login",
        href: "https://geffenacademy.myschoolapp.com/app#login",
        icon: "door"
      },
      {
        name: "Gradebook",
        desc: "SIS gradebook page",
        href: "https://geffenacademy.myschoolapp.com/sis-gradebook/gradebook/27966135?svcid=edu&addin=1",
        icon: "grade"
      }
    ];

    function iconSVG(kind){
      const common = 'fill="none" stroke="rgba(234,242,255,.92)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"';
      if (kind === "chat"){
        return `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path ${common} d="M4 5h16v10H7l-3 3V5z"/>
          <path ${common} d="M8 9h8M8 12h6"/>
        </svg>`;
      }
      if (kind === "grid"){
        return `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path ${common} d="M4 4h7v7H4zM13 4h7v7h-7zM4 13h7v7H4zM13 13h7v7h-7z"/>
        </svg>`;
      }
      if (kind === "badge"){
        return `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path ${common} d="M12 2l3 5 6 1-4 4 1 6-6-3-6 3 1-6-4-4 6-1 3-5z"/>
        </svg>`;
      }
      if (kind === "calendar"){
        return `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path ${common} d="M7 3v3M17 3v3M4 7h16M5 7v14h14V7"/>
          <path ${common} d="M7 11h4M7 15h4M13 11h4M13 15h4"/>
        </svg>`;
      }
      if (kind === "mask"){
        return `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path ${common} d="M4 6c4-3 12-3 16 0v6c0 6-8 10-8 10S4 18 4 12V6z"/>
          <path ${common} d="M8 12c1 1 2 1 3 0M13 12c1 1 2 1 3 0"/>
        </svg>`;
      }
      if (kind === "bolt"){
        return `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path ${common} d="M13 2L3 14h7l-1 8 12-14h-7l-1-6z"/>
        </svg>`;
      }
      if (kind === "door"){
        return `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path ${common} d="M4 21h16M7 21V4h10v17"/>
          <path ${common} d="M14 12h.01"/>
        </svg>`;
      }
      if (kind === "grade"){
        return `<svg viewBox="0 0 24 24" aria-hidden="true">
          <path ${common} d="M4 4h16v16H4z"/>
          <path ${common} d="M7 8h10M7 12h10M7 16h6"/>
        </svg>`;
      }
      return `<svg viewBox="0 0 24 24" aria-hidden="true"><path ${common} d="M4 12h16"/></svg>`;
    }

    /*************************
     * Geffen schedule data
     *************************/
    const blueWeek = {
      monday: [
        { time: "9:00-9:15", block: "Reading Period" },
        { time: "9:15-10:10", block: "A" },
        { time: "10:15-11:10", block: "B" },
        { time: "11:20-12:15", block: "C" },
        { time: "12:15-1:05", block: "MS/US Lunch +MS/US Clubs" },
        { time: "1:10-2:05", block: "D" },
        { time: "2:10-3:05", block: "E" },
        { time: "3:10-3:50", block: "H" }
      ],
      tuesday: [
        { time: "9:00-9:20", block: "Bulletin" },
        { time: "9:20-10:15", block: "F" },
        { time: "10:20-11:15", block: "G" },
        { time: "11:20-12:15", block: "A" },
        { time: "12:15-1:05", block: "MS/US Lunch +MS/US Clubs" },
        { time: "1:10-2:05", block: "B" },
        { time: "2:10-3:05", block: "C" },
        { time: "3:10-3:50", block: "H" }
      ],
      wednesday: [
        { time: "9:00-9:15", block: "Reading Period" },
        { time: "9:15-10:10", block: "D" },
        { time: "10:15-11:10", block: "E" },
        { time: "11:20-12:15", block: "F" },
        { time: "12:15-1:05", block: "MS/US Lunch +MS/US Clubs" },
        { time: "1:10-2:05", block: "G" },
        { time: "2:10-3:05", block: "A" },
        { time: "3:10-3:50", block: "H" }
      ],
      thursday: [
        { time: "9:00-9:15", block: "Reading Period" },
        { time: "9:15-10:10", block: "B" },
        { time: "10:15-11:10", block: "C" },
        { time: "11:20-12:15", block: "D" },
        { time: "12:15-1:05", block: "MS/US Lunch +MS/US Clubs" },
        { time: "1:10-2:05", block: "E" },
        { time: "2:10-3:05", block: "F" },
        { time: "3:10-3:50", block: "H" }
      ],
      friday: [
        { time: "8:00-8:50", block: "Educators’ Mtg." },
        { time: "9:00-9:55", block: "G" },
        { time: "10:00-10:55", block: "A" },
        { time: "11:05-12:00", block: "B" },
        { time: "12:00-1:05", block: "MS/US SuperLunch +Affinity Groups" },
        { time: "1:10-2:05", block: "C" },
        { time: "2:10-3:05", block: "D" },
        { time: "3:10-3:50", block: "H/X1" }
      ]
    };

    const goldWeek = {
      monday: [
        { time: "9:00-9:15", block: "Reading Period" },
        { time: "9:15-10:10", block: "E" },
        { time: "10:15-11:10", block: "F" },
        { time: "11:20-12:15", block: "G" },
        { time: "12:15-1:05", block: "MS/US Lunch +MS/US Clubs" },
        { time: "1:10-2:05", block: "A" },
        { time: "2:10-3:05", block: "B" },
        { time: "3:10-3:50", block: "H" }
      ],
      tuesday: [
        { time: "9:00-9:20", block: "Bulletin" },
        { time: "9:20-10:15", block: "C" },
        { time: "10:20-11:15", block: "D" },
        { time: "11:20-12:15", block: "E" },
        { time: "12:15-1:05", block: "MS/US Lunch +MS/US Clubs" },
        { time: "1:10-2:05", block: "F" },
        { time: "2:10-3:05", block: "G" },
        { time: "3:10-3:50", block: "H" }
      ],
      wednesday: [
        { time: "9:00-9:15", block: "Reading Period" },
        { time: "9:15-10:10", block: "A" },
        { time: "10:15-11:10", block: "B" },
        { time: "11:20-12:15", block: "C" },
        { time: "12:15-1:05", block: "MS/US Lunch +MS/US Clubs" },
        { time: "1:10-2:05", block: "D" },
        { time: "2:10-3:05", block: "E" },
        { time: "3:10-3:50", block: "H" }
      ],
      thursday: [
        { time: "9:00-9:15", block: "Reading Period" },
        { time: "9:15-10:10", block: "F" },
        { time: "10:15-11:10", block: "G" },
        { time: "11:20-12:15", block: "A" },
        { time: "12:15-1:05", block: "MS/US Lunch +MS/US Clubs" },
        { time: "1:10-2:05", block: "B" },
        { time: "2:10-3:05", block: "C" },
        { time: "3:10-3:50", block: "H" }
      ],
      friday: [
        { time: "8:00-8:50", block: "Educators’ Mtg." },
        { time: "9:00-9:55", block: "D" },
        { time: "10:00-10:55", block: "E" },
        { time: "11:00-11:45", block: "H" },
        { time: "11:45-12:35", block: "MS/US Lunch +MS/US Clubs" },
        { time: "12:40-1:35", block: "F" },
        { time: "1:40-2:35", block: "G" },
        { time: "2:40-3:20", block: "X3" }
      ]
    };

    const scheduleData = { blue: blueWeek, gold: goldWeek };
    const dayKeys = ["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];

    /*************************
     * Local Storage
     *************************/
    const LS_KEY = "ari_dashboard_v1";

    function safeJSONParse(s, fallback){
      try { return JSON.parse(s); } catch { return fallback; }
    }

    function defaultState(){
      const todayISO = toISODateLocal(new Date());
      return {
        anchor: { dateISO: todayISO, week: "blue" },
        blocks: { A:"",B:"",C:"",D:"",E:"",F:"",G:"",H:"" },
        officeHours: {
          blue: { monday:false, tuesday:false, wednesday:false, thursday:false, friday:false },
          gold: { monday:false, tuesday:false, wednesday:false, thursday:false, friday:false }
        },
        agendaByDate: {}
      };
    }

    function loadState(){
      const raw = localStorage.getItem(LS_KEY);
      const st = raw ? safeJSONParse(raw, null) : null;
      const base = defaultState();
      if (!st) return base;

      // merge shallowly
      return {
        ...base,
        ...st,
        anchor: { ...base.anchor, ...(st.anchor||{}) },
        blocks: { ...base.blocks, ...(st.blocks||{}) },
        officeHours: {
          blue: { ...base.officeHours.blue, ...(st.officeHours?.blue||{}) },
          gold: { ...base.officeHours.gold, ...(st.officeHours?.gold||{}) }
        },
        agendaByDate: { ...base.agendaByDate, ...(st.agendaByDate||{}) }
      };
    }

    function saveState(){
      localStorage.setItem(LS_KEY, JSON.stringify(state));
    }

    let state = loadState();

    /*************************
     * Date helpers (local)
     *************************/
    function pad2(n){ return String(n).padStart(2,"0"); }
    function toISODateLocal(d){
      return `${d.getFullYear()}-${pad2(d.getMonth()+1)}-${pad2(d.getDate())}`;
    }
    function fromISODateLocal(iso){
      const [y,m,da] = iso.split("-").map(Number);
      return new Date(y, m-1, da, 0,0,0,0);
    }
    function isWeekday(d){
      const dow = d.getDay();
      return dow >= 1 && dow <= 5;
    }

    /*************************
     * Compute week (AUTO)
     * Flip on Mondays, based on anchor.
     *************************/
    function computeWeekAuto(targetISO){
      const anchorISO = state.anchor.dateISO;
      const anchorWeek = state.anchor.week;

      if (!anchorISO || !anchorWeek) return "blue";

      const a = fromISODateLocal(anchorISO);
      const t = fromISODateLocal(targetISO);

      if (t.getTime() === a.getTime()) return anchorWeek;

      // iterate days from anchor to target, flipping on each Monday we pass
      const step = (t > a) ? 1 : -1;
      let curWeek = anchorWeek;
      let d = new Date(a.getTime());

      const safety = 3660;
      let i = 0;

      while (toISODateLocal(d) !== targetISO && i < safety){
        i++;
        d.setDate(d.getDate() + step);

        // flip week on Mondays only (direction-aware)
        if (d.getDay() === 1){
          curWeek = (curWeek === "blue") ? "gold" : "blue";
        }
      }
      return curWeek;
    }

    /*************************
     * Time parsing
     *************************/
    function parseTimeToMinutes(t){
      // "9:15" or "12:40"
      const [hh, mm] = t.split(":").map(Number);
      return (hh * 60) + (mm || 0);
    }

    function parseRangeToMinutes(rangeStr){
      // "9:15-10:10" or "12:15-1:05"
      const [a,b] = rangeStr.split("-").map(s => s.trim());
      const start = parseTimeToMinutes(a);
      let end = parseTimeToMinutes(b);

      // Handle crossing noon when end hour is smaller (e.g., 12:15-1:05)
      if (end < start) end += 12 * 60;

      // Handle 8:00-8:50 etc. ok
      return { start, end };
    }

    function isInstructionalBlock(blockLabel){
      // Count A–G always as instructional. H is instructional if named as class OR office hours checked for that day.
      return /^[A-G]$/.test(blockLabel) || blockLabel === "H";
    }

    function normalizeBlock(blockLabel){
      // In schedules: "H/X1" etc. Normalize to H for instructional end detection?
      if (blockLabel.startsWith("H")) return "H";
      if (/^[A-G]$/.test(blockLabel)) return blockLabel;
      return blockLabel;
    }

    function isLunchLike(blockLabel){
      return blockLabel.includes("Lunch") || blockLabel.includes("Bulletin") || blockLabel.includes("Reading") || blockLabel.includes("Educators") || blockLabel === "X3" || blockLabel === "X1" || blockLabel.includes("H/X1");
    }

    /*************************
     * UI wiring
     *************************/
    const dashDate = document.getElementById("dashDate");
    const weekMode = document.getElementById("weekMode");
    const todayBtn = document.getElementById("todayBtn");

    const anchorDate = document.getElementById("anchorDate");
    const anchorWeek = document.getElementById("anchorWeek");
    const saveAnchorBtn = document.getElementById("saveAnchorBtn");

    const agenda = document.getElementById("agenda");
    const dayScheduleEl = document.getElementById("daySchedule");

    const nowLabel = document.getElementById("nowLabel");
    const nextLabel = document.getElementById("nextLabel");
    const coreMeta = document.getElementById("coreMeta");

    const blkInputs = {
      A: document.getElementById("blkA"),
      B: document.getElementById("blkB"),
      C: document.getElementById("blkC"),
      D: document.getElementById("blkD"),
      E: document.getElementById("blkE"),
      F: document.getElementById("blkF"),
      G: document.getElementById("blkG"),
      H: document.getElementById("blkH")
    };

    const ohBlue = document.getElementById("ohBlue");
    const ohGold = document.getElementById("ohGold");

    const saveBtn = document.getElementById("saveBtn");
    const copyBtn = document.getElementById("copyBtn");
    const exportBtn = document.getElementById("exportBtn");
    const importBtn = document.getElementById("importBtn");
    const resetBtn = document.getElementById("resetBtn");
    const importFile = document.getElementById("importFile");

    // Energy grid
    const cellsWrap = document.getElementById("cells");
    const energyPct = document.getElementById("energyPct");
    const energyHint = document.getElementById("energyHint");

    // Build 60 cells (12x5)
    const CELL_COUNT = 60;
    const energyCells = [];
    function buildEnergyCells(){
      cellsWrap.innerHTML = "";
      for (let i=0;i<CELL_COUNT;i++){
        const c = document.createElement("div");
        c.className = "cell";
        cellsWrap.appendChild(c);
        energyCells.push(c);
      }
    }
    buildEnergyCells();

    /*************************
     * Office hours UI
     *************************/
    const wkDays = ["monday","tuesday","wednesday","thursday","friday"];

    function ohCheckboxHTML(week, day){
      const id = `oh_${week}_${day}`;
      const wrap = document.createElement("label");
      wrap.style.display = "flex";
      wrap.style.alignItems = "center";
      wrap.style.gap = "10px";
      wrap.style.padding = "8px 10px";
      wrap.style.borderRadius = "14px";
      wrap.style.border = "1px solid rgba(155,188,255,.16)";
      wrap.style.background = "rgba(0,0,0,.18)";
      wrap.style.cursor = "pointer";
      wrap.style.userSelect = "none";

      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.id = id;
      cb.checked = !!state.officeHours[week][day];
      cb.style.width = "18px";
      cb.style.height = "18px";
      cb.style.accentColor = (week === "blue") ? "#49D7FF" : "#D9B04C";

      const span = document.createElement("span");
      span.textContent = day[0].toUpperCase() + day.slice(1);
      span.style.fontFamily = "var(--mono)";
      span.style.fontSize = "12px";
      span.style.fontWeight = "900";
      span.style.color = "rgba(234,242,255,.90)";

      wrap.appendChild(cb);
      wrap.appendChild(span);

      cb.addEventListener("change", () => {
        state.officeHours[week][day] = cb.checked;
        saveState();
        renderAll();
      });

      return wrap;
    }

    function buildOfficeHoursUI(){
      ohBlue.innerHTML = "";
      ohGold.innerHTML = "";
      wkDays.forEach(d => ohBlue.appendChild(ohCheckboxHTML("blue", d)));
      wkDays.forEach(d => ohGold.appendChild(ohCheckboxHTML("gold", d)));
    }
    buildOfficeHoursUI();

    /*************************
     * Load inputs
     *************************/
    function loadInputs(){
      // date
      dashDate.value = dashDate.value || toISODateLocal(new Date());

      // anchor
      anchorDate.value = state.anchor.dateISO || toISODateLocal(new Date());
      anchorWeek.value = state.anchor.week || "blue";

      // blocks
      Object.keys(blkInputs).forEach(k => {
        blkInputs[k].value = state.blocks[k] || "";
      });

      // agenda for current date
      const iso = dashDate.value;
      agenda.value = state.agendaByDate[iso] || "";
    }

    /*************************
     * Determine day week
     *************************/
    function getEffectiveWeekForISO(iso){
      const mode = weekMode.value;
      if (mode === "blue" || mode === "gold") return mode;
      return computeWeekAuto(iso);
    }

    function dayKeyForISO(iso){
      const d = fromISODateLocal(iso);
      return dayKeys[d.getDay()];
    }

    /*************************
     * Render schedule for day
     *************************/
    function displayNameForBlock(block, week, dayKey){
      // If A–H has a name, use it.
      if (/^[A-H]$/.test(block) && state.blocks[block]?.trim()){
        return `${state.blocks[block].trim()} (${block})`;
      }
      // Office hours logic for H if no H name is given
      if (block === "H"){
        const hNamed = (state.blocks.H || "").trim().length > 0;
        if (!hNamed && wkDays.includes(dayKey) && state.officeHours[week][dayKey]){
          return `Office Hours (H)`;
        }
      }
      return block;
    }

    function classifyRow(blockLabelRaw){
      const b = blockLabelRaw;
      if (b.includes("Lunch")) return "endcap";
      if (b.includes("SuperLunch")) return "endcap";
      if (b.includes("Affinity")) return "endcap";
      if (b.includes("Bulletin") || b.includes("Reading") || b.includes("Educators")) return "";
      if (/^[A-H]$/.test(b) || b.startsWith("H/")) return "classRow";
      return "";
    }

    function getDaySchedule(iso){
      const week = getEffectiveWeekForISO(iso);
      const dk = dayKeyForISO(iso);
      if (!wkDays.includes(dk)){
        return { week, dk, periods: [] };
      }
      const periods = scheduleData[week][dk] || [];
      return { week, dk, periods };
    }

    function renderDaySchedule(){
      const iso = dashDate.value;
      const { week, dk, periods } = getDaySchedule(iso);

      const dateObj = fromISODateLocal(iso);
      const weekdayName = dk.toUpperCase();
      const nice = dateObj.toLocaleDateString(undefined, { weekday:"long", month:"short", day:"numeric", year:"numeric" });

      coreMeta.innerHTML = `
        <div style="font-family:var(--mono); font-weight:900; color: rgba(234,242,255,.92); letter-spacing:.06em;">
          ${nice}
        </div>
        <div style="margin-top:6px; font-family:var(--mono); color: rgba(169,182,214,.92);">
          WEEK: <span style="color:rgba(234,242,255,.92); font-weight:900;">${week.toUpperCase()}</span>
          <span style="opacity:.55">•</span>
          DAY: <span style="color:rgba(234,242,255,.92); font-weight:900;">${weekdayName}</span>
        </div>
      `;

      if (!wkDays.includes(dk)){
        dayScheduleEl.innerHTML = `
          <div class="row endcap">
            <div class="time">—</div>
            <div class="what">No school day. <span class="tag">Weekend</span></div>
          </div>
        `;
        nowLabel.textContent = "—";
        nextLabel.textContent = "—";
        return;
      }

      // Build rows
      let html = "";
      periods.forEach(p => {
        const raw = p.block;
        const norm = normalizeBlock(raw);
        const name = (/^[A-H]$/.test(norm)) ? displayNameForBlock(norm, week, dk) : raw;

        const rowClass = classifyRow(raw);
        const tag = (/^[A-H]$/.test(norm)) ? `<span class="tag">${norm}</span>` : `<span class="tag">SYS</span>`;

        html += `
          <div class="row ${rowClass}">
            <div class="time">${p.time}</div>
            <div class="what">${escapeHTML(name)} ${tag}</div>
          </div>
        `;
      });

      dayScheduleEl.innerHTML = html;

      // Compute NOW / NEXT labels based on current time (only if the dashboard date is today)
      const todayISO = toISODateLocal(new Date());
      if (iso !== todayISO){
        nowLabel.textContent = "—";
        nextLabel.textContent = "—";
        return;
      }

      const now = new Date();
      const minsNow = now.getHours() * 60 + now.getMinutes();

      // Find now period by time ranges
      const windows = periods.map(p => {
        const { start, end } = parseRangeToMinutes(p.time);
        return { ...p, start, end };
      });

      const current = windows.find(w => minsNow >= w.start && minsNow < w.end);
      const next = windows.find(w => minsNow < w.start);

      if (current){
        const norm = normalizeBlock(current.block);
        const title = (/^[A-H]$/.test(norm)) ? displayNameForBlock(norm, week, dk) : current.block;
        nowLabel.textContent = (title.length > 24) ? title.slice(0,24) + "…" : title;
      } else {
        nowLabel.textContent = (minsNow < windows[0].start) ? "Pre-school" : "After-hours";
      }

      if (next){
        const norm = normalizeBlock(next.block);
        const title = (/^[A-H]$/.test(norm)) ? displayNameForBlock(norm, week, dk) : next.block;
        nextLabel.textContent = (title.length > 24) ? title.slice(0,24) + "…" : title;
      } else {
        nextLabel.textContent = "—";
      }
    }

    function escapeHTML(s){
      return String(s)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    /*************************
     * Energy grid logic
     * - progresses from first instructional start to last instructional end
     * - subtle fluctuation, but converges
     *************************/
    function getInstructionalWindowForDay(iso){
      const { week, dk, periods } = getDaySchedule(iso);
      if (!wkDays.includes(dk)) return null;

      // Build time windows
      const windows = periods.map(p => {
        const { start, end } = parseRangeToMinutes(p.time);
        const raw = p.block;
        const norm = normalizeBlock(raw);
        return { raw, norm, start, end };
      });

      // Determine which windows count as instructional (A–G always; H only if named or office hours checked)
      const hNamed = (state.blocks.H || "").trim().length > 0;
      const hOffice = state.officeHours[week]?.[dk] === true;

      const instr = windows.filter(w => {
        if (/^[A-G]$/.test(w.norm)) return true;
        if (w.norm === "H"){
          // includes H and H/X1. Only count if H named or office hours checked.
          return hNamed || hOffice;
        }
        return false;
      });

      if (!instr.length) return null;

      // first start is min start, last end is max end among instructional
      const firstStart = Math.min(...instr.map(w => w.start));
      const lastEnd = Math.max(...instr.map(w => w.end));
      return { week, dk, firstStart, lastEnd, instr };
    }

    let energyTarget = 0;   // where progress should be
    let energyShown = 0;    // eased display value
    let breathPhase = 0;

    function updateEnergy(){
      const iso = dashDate.value;
      const todayISO = toISODateLocal(new Date());

      const win = getInstructionalWindowForDay(iso);
      if (!win){
        // no instructional day
        energyTarget = 0;
        energyShown = Math.max(0, energyShown * 0.92);
        paintEnergy(energyShown, "No instructional blocks detected.");
        return;
      }

      // For non-today dates, show 100% if in past, 0% if in future (relative to today)
      if (iso !== todayISO){
        const d = fromISODateLocal(iso);
        const t = fromISODateLocal(todayISO);
        energyTarget = (d < t) ? 1 : 0;
        energyShown += (energyTarget - energyShown) * 0.12;
        paintEnergy(energyShown, iso < todayISO ? "Past day: completed." : "Future day: standing by.");
        return;
      }

      const now = new Date();
      const mins = now.getHours() * 60 + now.getMinutes() + (now.getSeconds()/60);

      const { firstStart, lastEnd } = win;

      let base;
      if (mins <= firstStart) base = 0;
      else if (mins >= lastEnd) base = 1;
      else base = (mins - firstStart) / (lastEnd - firstStart);

      // subtle breathing that fades as we approach end (so it "converges")
      breathPhase += 0.035;
      const breath = Math.sin(breathPhase) * 0.012 * (1 - base);

      // target with tiny breath; clamp
      energyTarget = Math.min(1, Math.max(0, base + breath));

      // ease display toward target
      energyShown += (energyTarget - energyShown) * 0.10;

      const hint = (base >= 1) ? "Day complete (instructional end reached)." : "Charging toward last class block…";
      paintEnergy(energyShown, hint);
    }

    function paintEnergy(p, hint){
      const pct = Math.round(p * 100);
      energyPct.textContent = `CHARGE: ${pct}%`;
      energyHint.textContent = hint;

      // Determine how many cells should be ON
      const onCount = Math.floor(p * CELL_COUNT);

      // Add a gentle shimmer/pulse on the next few cells
      const shimmerIndex = Math.min(CELL_COUNT - 1, onCount);

      energyCells.forEach((c, i) => {
        const shouldOn = i < onCount;
        c.classList.toggle("on", shouldOn);

        // pulse occasionally on the frontier
        const nearFrontier = (i === shimmerIndex || i === shimmerIndex+1);
        if (!shouldOn && nearFrontier && Math.random() < 0.08){
          c.classList.add("pulse");
          setTimeout(() => c.classList.remove("pulse"), 200);
        }
      });
    }

    /*************************
     * Save / copy / import / export / reset
     *************************/
    function storeBlocksFromInputs(){
      Object.keys(blkInputs).forEach(k => {
        state.blocks[k] = (blkInputs[k].value || "").trim();
      });
    }

    function storeAgendaForDate(){
      const iso = dashDate.value;
      state.agendaByDate[iso] = agenda.value || "";
    }

    function toast(msg){
      // intentionally simple (retro)
      alert(msg);
    }

    function saveAll(){
      storeBlocksFromInputs();
      storeAgendaForDate();
      saveState();
      renderAll();
      toast("Saved locally.");
    }

    function copyDayText(){
      const iso = dashDate.value;
      const { week, dk, periods } = getDaySchedule(iso);

      const dateObj = fromISODateLocal(iso);
      const nice = dateObj.toLocaleDateString(undefined, { weekday:"long", month:"short", day:"numeric", year:"numeric" });

      const lines = [];
      lines.push(`GEFFEN FIELD TERMINAL`);
      lines.push(`${nice} — ${week.toUpperCase()} — ${dk.toUpperCase()}`);
      lines.push("");

      if (!wkDays.includes(dk)){
        lines.push("No school day.");
      } else {
        periods.forEach(p => {
          const raw = p.block;
          const norm = normalizeBlock(raw);
          let label = raw;
          if (/^[A-H]$/.test(norm)){
            label = displayNameForBlock(norm, week, dk);
          }
          lines.push(`${p.time}  ${label}`);
        });
      }

      lines.push("");
      lines.push("AGENDA:");
      lines.push((state.agendaByDate[iso] || "").trim() || "—");

      const text = lines.join("\n");

      navigator.clipboard?.writeText(text)
        .then(()=> toast("Copied day summary."))
        .catch(()=>{
          // fallback
          const ta = document.createElement("textarea");
          ta.value = text;
          document.body.appendChild(ta);
          ta.select();
          try{ document.execCommand("copy"); toast("Copied day summary."); }
          catch{ toast("Copy failed."); }
          document.body.removeChild(ta);
        });
    }

    function exportJSON(){
      const blob = new Blob([JSON.stringify(state, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "ari_dashboard_export.json";
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importJSONFile(file){
      file.text().then(txt => {
        const incoming = safeJSONParse(txt, null);
        if (!incoming || typeof incoming !== "object"){
          toast("Invalid JSON.");
          return;
        }
        // merge in
        const base = defaultState();
        state = {
          ...base,
          ...incoming,
          anchor: { ...base.anchor, ...(incoming.anchor||{}) },
          blocks: { ...base.blocks, ...(incoming.blocks||{}) },
          officeHours: {
            blue: { ...base.officeHours.blue, ...(incoming.officeHours?.blue||{}) },
            gold: { ...base.officeHours.gold, ...(incoming.officeHours?.gold||{}) }
          },
          agendaByDate: { ...base.agendaByDate, ...(incoming.agendaByDate||{}) }
        };
        saveState();
        buildOfficeHoursUI();
        loadInputs();
        renderAll();
        toast("Imported.");
      });
    }

    function resetLocal(){
      if (!confirm("Reset all local dashboard data? This cannot be undone.")) return;
      localStorage.removeItem(LS_KEY);
      state = loadState();
      buildOfficeHoursUI();
      loadInputs();
      renderAll();
      toast("Reset complete.");
    }

    /*************************
     * Ring hub positioning + crank rotation
     *************************/
    const hub = document.getElementById("hub");
    const crank = document.getElementById("crank");
    const crankArm = document.getElementById("crankArm");

    let angle = 0;              // radians
    let angularVel = 0;         // inertial
    let selectedIndex = 0;

    const nodes = [];

    function buildNodes(){
      // remove old
      nodes.forEach(n => n.remove());
      nodes.length = 0;

      LINKS.forEach((link, idx) => {
        const el = document.createElement("div");
        el.className = "node";
        el.setAttribute("role", "button");
        el.setAttribute("tabindex", "0");
        el.dataset.idx = String(idx);

        el.innerHTML = `
          <div class="row">
            <div class="icon">${iconSVG(link.icon)}</div>
            <div>
              <div class="name">${escapeHTML(link.name)}</div>
              <div class="desc">${escapeHTML(link.desc)}</div>
            </div>
          </div>
        `;

        el.addEventListener("click", () => {
          selectedIndex = idx;
          renderRing();
          window.open(link.href, "_blank", "noopener");
        });

        el.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " "){
            e.preventDefault();
            selectedIndex = idx;
            renderRing();
            window.open(link.href, "_blank", "noopener");
          }
        });

        hub.appendChild(el);
        nodes.push(el);
      });
    }
    buildNodes();

    function renderRing(){
      const N = nodes.length;
      const rect = hub.getBoundingClientRect();
      const size = Math.min(rect.width, rect.height);

      const r = size * 0.38;         // orbit radius
      const tilt = 0.78;             // vertical squash for “perspective”

      // Determine which node is “front” (closest to right side) for selection highlight
      // We'll compute each node angle and choose closest to 0 rad (rightmost).
      let bestIdx = 0;
      let bestScore = -Infinity;

      for (let i=0;i<N;i++){
        const a = angle + (i * (Math.PI * 2 / N));
        const x = Math.cos(a);
        const y = Math.sin(a) * tilt;

        // score: rightmost and slightly lower gives a “front” feel
        const score = (x * 1.2) - (y * 0.15);
        if (score > bestScore){
          bestScore = score;
          bestIdx = i;
        }
      }
      selectedIndex = bestIdx;

      for (let i=0;i<N;i++){
        const el = nodes[i];
        const a = angle + (i * (Math.PI * 2 / N));

        const x = Math.cos(a);
        const y = Math.sin(a) * tilt;

        const px = (x * r);
        const py = (y * r);

        // depth: map x to scale/opacity (front/right feels closer)
        const depth = (x + 1) / 2; // 0..1
        const scale = 0.86 + depth * 0.26;
        const opacity = 0.50 + depth * 0.50;

        const z = Math.round(100 + depth * 100);
        el.style.zIndex = z;

        const selected = (i === selectedIndex);
        el.classList.toggle("selected", selected);

        const bump = selected ? 10 : 0;
        const finalX = px + bump;

        el.style.opacity = opacity.toFixed(3);
        el.style.transform = `translate(-50%,-50%) translate(${finalX}px, ${py}px) scale(${scale})`;
      }

      // crank arm visuals follow angle (mapped)
      const deg = ((angle % (Math.PI*2)) * 180 / Math.PI);
      crankArm.style.transform = `translate(0,-50%) rotate(${deg}deg)`;
    }

    function stepInertia(){
      // friction
      angularVel *= 0.965;
      if (Math.abs(angularVel) < 0.00008) angularVel = 0;
      angle += angularVel;

      renderRing();
      requestAnimationFrame(stepInertia);
    }
    requestAnimationFrame(stepInertia);

    // Wheel to rotate
    hub.addEventListener("wheel", (e) => {
      e.preventDefault();
      angularVel += (e.deltaY * 0.00005);
    }, { passive: false });

    // Keyboard rotate
    window.addEventListener("keydown", (e) => {
      if (e.key === "ArrowLeft"){ angularVel -= 0.02; }
      if (e.key === "ArrowRight"){ angularVel += 0.02; }
      if (e.key === "Enter"){
        const link = LINKS[selectedIndex];
        if (link) window.open(link.href, "_blank", "noopener");
      }
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "s"){
        e.preventDefault();
        saveAll();
      }
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "e"){
        e.preventDefault();
        exportJSON();
      }
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === "i"){
        e.preventDefault();
        importFile.click();
      }
    });

    // Crank drag rotation
    let dragging = false;
    let dragStartAngle = 0;
    let dragStartPointerAngle = 0;

    function pointerAngleFromEvent(ev){
      const r = crank.getBoundingClientRect();
      const cx = r.left + r.width/2;
      const cy = r.top + r.height/2;
      const x = (ev.clientX ?? (ev.touches?.[0]?.clientX)) - cx;
      const y = (ev.clientY ?? (ev.touches?.[0]?.clientY)) - cy;
      return Math.atan2(y, x);
    }

    function normAngle(a){
      while (a <= -Math.PI) a += Math.PI*2;
      while (a > Math.PI) a -= Math.PI*2;
      return a;
    }

    crank.addEventListener("pointerdown", (e) => {
      dragging = true;
      crank.setPointerCapture(e.pointerId);
      angularVel = 0;
      dragStartAngle = angle;
      dragStartPointerAngle = pointerAngleFromEvent(e);
    });

    crank.addEventListener("pointermove", (e) => {
      if (!dragging) return;
      const pAng = pointerAngleFromEvent(e);
      const delta = normAngle(pAng - dragStartPointerAngle);
      angle = dragStartAngle + delta;
      // estimate velocity for inertia
      angularVel = delta * 0.10;
      renderRing();
    });

    crank.addEventListener("pointerup", () => { dragging = false; });
    crank.addEventListener("pointercancel", () => { dragging = false; });

    /*************************
     * Render everything
     *************************/
    function renderAgendaForDate(){
      const iso = dashDate.value;
      agenda.value = state.agendaByDate[iso] || "";
    }

    function renderAll(){
      renderDaySchedule();
      renderAgendaForDate();
      renderRing();
    }

    /*************************
     * Events: date / week / anchor / inputs
     *************************/
    todayBtn.addEventListener("click", () => {
      dashDate.value = toISODateLocal(new Date());
      renderAgendaForDate();
      renderAll();
    });

    dashDate.addEventListener("change", () => {
      renderAgendaForDate();
      renderAll();
    });

    weekMode.addEventListener("change", () => {
      renderAll();
    });

    saveAnchorBtn.addEventListener("click", () => {
      const d = anchorDate.value;
      if (!d){ toast("Pick an anchor date."); return; }
      state.anchor.dateISO = d;
      state.anchor.week = anchorWeek.value;
      saveState();
      renderAll();
      toast("Anchor saved. AUTO week updated.");
    });

    // block name inputs: save on blur
    Object.keys(blkInputs).forEach(k => {
      blkInputs[k].addEventListener("blur", () => {
        storeBlocksFromInputs();
        saveState();
        renderAll();
      });
    });

    // agenda: autosave after pause
    let agendaTimer = null;
    agenda.addEventListener("input", () => {
      clearTimeout(agendaTimer);
      agendaTimer = setTimeout(() => {
        storeAgendaForDate();
        saveState();
      }, 450);
    });

    saveBtn.addEventListener("click", saveAll);
    copyBtn.addEventListener("click", copyDayText);
    exportBtn.addEventListener("click", exportJSON);
    importBtn.addEventListener("click", () => importFile.click());
    resetBtn.addEventListener("click", resetLocal);

    importFile.addEventListener("change", () => {
      const file = importFile.files && importFile.files[0];
      if (!file) return;
      importJSONFile(file);
      importFile.value = "";
    });

    /*************************
     * Init
     *************************/
    // initial date
    dashDate.value = toISODateLocal(new Date());
    // load saved fields
    loadInputs();
    renderAll();
    // initial ring render after layout
    setTimeout(renderRing, 50);

    // Energy update loop
    setInterval(() => updateEnergy(), 250);
    updateEnergy();
  </script>
</body>
</html>
